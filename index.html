<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acompanhamento Terap√™utico - Pectus Excavatum</title>
    <style>
        * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Inter', 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
    background: linear-gradient(135deg, #F8F9FD 0%, #E8EBF7 100%);
    min-height: 100vh;
    padding: 15px;
    color: #1E293B;
}

.container {
    max-width: 1100px;
    margin: 0 auto;
}

/* ========================================
   HEADER - CLEAN E LEVE
   ======================================== */

header {
    background: #FFFFFF;
    padding: 20px 25px;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(15, 23, 42, 0.06);
    margin-bottom: 20px;
    text-align: center;
    border: 1px solid rgba(124, 58, 237, 0.1);
}

h1 {
    color: #7C3AED;
    font-size: 1.8em;
    font-weight: 700;
    margin-bottom: 6px;
    letter-spacing: -0.5px;
}

.subtitle {
    color: #64748B;
    font-size: 0.95em;
    font-weight: 500;
}

/* ========================================
   XP CONTAINER - GLASSMORPHISM SUTIL
   ======================================== */

.xp-container {
    background: linear-gradient(135deg, rgba(124, 58, 237, 0.95), rgba(99, 102, 241, 0.95));
    padding: 20px;
    border-radius: 12px;
    color: white;
    margin-bottom: 20px;
    box-shadow: 0 4px 16px rgba(124, 58, 237, 0.25);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.rank-display {
    text-align: center;
    margin-bottom: 16px;
}

.rank-badge {
    display: inline-block;
    background: rgba(255, 255, 255, 0.2);
    padding: 10px 24px;
    border-radius: 50px;
    font-size: 1.1em;
    font-weight: 600;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.3);
}

.xp-bars {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 12px;
    margin-top: 16px;
}

.xp-bar-container {
    background: rgba(255, 255, 255, 0.15);
    padding: 12px;
    border-radius: 8px;
    backdrop-filter: blur(8px);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.xp-bar-label {
    display: flex;
    justify-content: space-between;
    margin-bottom: 6px;
    font-size: 0.85em;
    font-weight: 600;
}

.xp-bar {
    height: 20px;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 10px;
    overflow: hidden;
}

.xp-bar-fill {
    height: 100%;
    background: linear-gradient(90deg, #00E5FF, #00B8D4);
    transition: width 0.5s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8em;
    font-weight: 700;
    box-shadow: 0 0 10px rgba(0, 229, 255, 0.5);
}

/* ========================================
   MESSAGE BOX - FLAT DESIGN
   ======================================== */

#messageContainer {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 9999;
    display: flex;
    flex-direction: column;
    gap: 12px;
    max-width: 400px;
    pointer-events: none;
}

.message-box {
    padding: 14px 18px 14px 14px;
    border-radius: 10px;
    animation: slideInRight 0.4s ease, fadeOut 0.4s ease 4.6s;
    font-size: 0.9em;
    font-weight: 500;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
    pointer-events: auto;
    position: relative;
    border-left: 4px solid;
    backdrop-filter: blur(10px);
    min-width: 300px;
    display: flex;
    align-items: center;
    gap: 10px;
}

/* Anima√ß√µes */
@keyframes slideInRight {
    from {
        opacity: 0;
        transform: translateX(100px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

@keyframes fadeOut {
    from {
        opacity: 1;
        transform: translateX(0);
    }
    to {
        opacity: 0;
        transform: translateX(100px);
    }
}

/* Tipos de mensagem */
.message-success {
    background: linear-gradient(135deg, #ECFDF5 0%, #D1FAE5 100%);
    border-left-color: #10B981;
    color: #065F46;
}

.message-success::before {
    content: '‚úÖ';
    font-size: 1.3em;
    flex-shrink: 0;
}

.message-warning {
    background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%);
    border-left-color: #F59E0B;
    color: #92400E;
}

.message-warning::before {
    content: '‚ö†Ô∏è';
    font-size: 1.3em;
    flex-shrink: 0;
}

.message-info {
    background: linear-gradient(135deg, #DBEAFE 0%, #BFDBFE 100%);
    border-left-color: #3B82F6;
    color: #1E40AF;
}

.message-info::before {
    content: '‚ÑπÔ∏è';
    font-size: 1.3em;
    flex-shrink: 0;
}

/* Bot√£o de fechar (opcional) */
.message-box::after {
    content: '√ó';
    position: absolute;
    top: 8px;
    right: 10px;
    font-size: 1.4em;
    color: inherit;
    opacity: 0.5;
    cursor: pointer;
    font-weight: 700;
    line-height: 1;
    transition: opacity 0.2s;
}

.message-box:hover::after {
    opacity: 1;
}

/* Mobile - Ajuste para telas pequenas */
@media (max-width: 768px) {
    #messageContainer {
        top: 10px;
        right: 10px;
        left: 10px;
        max-width: none;
    }

    .message-box {
        min-width: auto;
        width: 100%;
        font-size: 0.85em;
        padding: 12px 14px;
    }

    @keyframes slideInRight {
        from {
            opacity: 0;
            transform: translateY(-50px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes fadeOut {
        from {
            opacity: 1;
            transform: translateY(0);
        }
        to {
            opacity: 0;
            transform: translateY(-50px);
        }
    }
}

/* ========================================
   DASHBOARD CARDS - CLEAN E COMPACTO
   ======================================== */

.dashboard {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-bottom: 20px;
}

.stat-card {
    background: #FFFFFF;
    padding: 18px;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(15, 23, 42, 0.06);
    transition: all 0.3s ease;
    border: 1px solid rgba(124, 58, 237, 0.08);
}

.stat-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(124, 58, 237, 0.15);
}

.stat-card h3 {
    color: #7C3AED;
    font-size: 0.8em;
    text-transform: uppercase;
    margin-bottom: 8px;
    font-weight: 700;
    letter-spacing: 0.5px;
}

.stat-value {
    font-size: 2.2em;
    font-weight: 800;
    color: #1E293B;
    line-height: 1;
}

.stat-label {
    color: #64748B;
    font-size: 0.85em;
    margin-top: 4px;
    font-weight: 500;
}

/* ========================================
   TABS - MINIMALISTA
   ======================================== */

.tabs {
    display: flex;
    gap: 8px;
    margin-bottom: 16px;
    flex-wrap: wrap;
}

.tab-button {
    background: #FFFFFF;
    border: 1px solid rgba(124, 58, 237, 0.15);
    padding: 10px 18px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.9em;
    font-weight: 600;
    transition: all 0.3s ease;
    color: #64748B;
}

.tab-button:hover {
    background: #F1F5F9;
    color: #7C3AED;
    border-color: rgba(124, 58, 237, 0.3);
}

.tab-button.active {
    background: linear-gradient(135deg, #7C3AED, #6366F1);
    color: white;
    border-color: transparent;
    box-shadow: 0 0 20px rgba(124, 58, 237, 0.4),
                0 0 40px rgba(124, 58, 237, 0.2),
                inset 0 0 10px rgba(255, 255, 255, 0.2);
}

/* ========================================
   TAB CONTENT - LIGHT MODE
   ======================================== */

.tab-content {
    display: none;
    background: #FFFFFF;
    padding: 24px;
    border-radius: 12px;
    box-shadow: 0 2px 12px rgba(15, 23, 42, 0.08);
    border: 1px solid rgba(124, 58, 237, 0.1);
}

.tab-content.active {
    display: block;
}

.section-title {
    color: #7C3AED;
    font-size: 1.6em;
    margin-bottom: 16px;
    border-bottom: 2px solid #E2E8F0;
    padding-bottom: 8px;
    font-weight: 700;
}

/* ========================================
   FORMS - CLEAN DESIGN
   ======================================== */

.form-group {
    margin-bottom: 16px;
}

label {
    display: block;
    margin-bottom: 6px;
    color: #334155;
    font-weight: 600;
    font-size: 0.9em;
}

input[type="number"],
input[type="text"],
input[type="date"],
select,
textarea {
    width: 100%;
    padding: 10px 12px;
    border: 1.5px solid #E2E8F0;
    border-radius: 8px;
    font-size: 0.95em;
    transition: all 0.3s ease;
    background: #F8FAFC;
    color: #1E293B;
}

input:focus,
select:focus,
textarea:focus {
    outline: none;
    border-color: #7C3AED;
    background: #FFFFFF;
    box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
}

textarea {
    resize: vertical;
    min-height: 90px;
    font-family: inherit;
}

/* ========================================
   BOT√ïES COM NEON GLOW REAL
   ======================================== */

.btn {
    background: linear-gradient(135deg, #7C3AED, #6366F1);
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.95em;
    font-weight: 700;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3);
    position: relative;
    overflow: hidden;
}

.btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    transition: left 0.5s ease;
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 0 25px rgba(124, 58, 237, 0.6),
                0 0 50px rgba(124, 58, 237, 0.3),
                0 8px 20px rgba(124, 58, 237, 0.4);
}

.btn:hover::before {
    left: 100%;
}

.btn:active {
    transform: translateY(0);
    box-shadow: 0 0 30px rgba(124, 58, 237, 0.8),
                0 0 60px rgba(124, 58, 237, 0.5);
}

.btn-success {
    background: linear-gradient(135deg, #10B981, #059669);
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
}

.btn-success:hover {
    box-shadow: 0 0 25px rgba(16, 185, 129, 0.6),
                0 0 50px rgba(16, 185, 129, 0.3),
                0 8px 20px rgba(16, 185, 129, 0.4);
}

/* ========================================
   DAILY CARE - FLAT DESIGN
   ======================================== */

.daily-care {
    background: #F8FAFC;
    padding: 16px;
    border-radius: 8px;
    margin: 16px 0;
    border: 1.5px solid #E2E8F0;
}

.care-checkbox {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px;
    background: white;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s ease;
    border: 1px solid #E2E8F0;
}

.care-checkbox:hover {
    background: #F1F5F9;
    border-color: #7C3AED;
}

.care-checkbox input[type="checkbox"] {
    width: 22px;
    height: 22px;
    cursor: pointer;
    accent-color: #7C3AED;
}

/* ========================================
   CALENDAR - CLEAN GRID
   ======================================== */

.calendar {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 8px;
    margin-top: 16px;
}

.calendar-day {
    aspect-ratio: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: #F8FAFC;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    padding: 2px;
    font-size: 0.75em;
    border: 1px solid #E2E8F0;
    min-height: 45px;
}

.calendar-day:hover {
    background: #E2E8F0;
    transform: scale(1.05);
}

.calendar-day.completed {
    background: linear-gradient(135deg, #10B981, #059669);
    color: white;
    border-color: #059669;
    box-shadow: 0 0 15px rgba(16, 185, 129, 0.4);
}

.calendar-day.today {
    border: 2px solid #7C3AED;
    box-shadow: 0 0 12px rgba(124, 58, 237, 0.3);
}

.calendar-icons {
    font-size: 0.65em;
    margin-top: 1px;
    display: flex;
    gap: 2px;
    flex-wrap: wrap;
    justify-content: center;
}

.calendar-xp {
    font-size: 0.6em;
    color: #7C3AED;
    font-weight: 700;
    margin-top: 1px;
}

.calendar-header {
    font-weight: 700;
    color: #7C3AED;
    text-align: center;
    padding: 8px;
    font-size: 0.8em;
}

/* ========================================
   HISTORY ITEMS - CLEAN
   ======================================== */

.history-item {
    background: #F8FAFC;
    padding: 12px 14px;
    border-radius: 8px;
    margin-bottom: 8px;
    border-left: 3px solid #7C3AED;
    font-size: 0.9em;
}

.history-date {
    font-weight: 700;
    color: #7C3AED;
    margin-bottom: 4px;
    font-size: 0.95em;
}

.history-details {
    color: #64748B;
    font-size: 0.9em;
}

/* ========================================
   INFO BOX - FLAT
   ======================================== */

.info-box {
    background: #EFF6FF;
    border-left: 3px solid #3B82F6;
    padding: 12px 14px;
    border-radius: 8px;
    margin: 16px 0;
    font-size: 0.9em;
}

.info-box strong {
    color: #1E40AF;
    font-weight: 700;
}

/* ========================================
   MONTH SELECTOR - NEON BUTTONS
   ======================================== */

.month-selector {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
    padding: 12px;
    background: #F8FAFC;
    border-radius: 8px;
    border: 1px solid #E2E8F0;
}

.month-selector button {
    background: linear-gradient(135deg, #00E5FF, #00B8D4);
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 700;
    font-size: 0.9em;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(0, 229, 255, 0.3);
}

.month-selector button:hover {
    box-shadow: 0 0 20px rgba(0, 229, 255, 0.6),
                0 0 40px rgba(0, 229, 255, 0.3);
    transform: translateY(-2px);
}

.month-selector span {
    font-weight: 700;
    font-size: 1.1em;
    color: #1E293B;
}

/* ========================================
   IMAGE UPLOAD - MODERN
   ======================================== */

.image-upload {
    border: 2px dashed #CBD5E1;
    padding: 24px;
    border-radius: 8px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    background: #F8FAFC;
}

.image-upload:hover {
    background: #EFF6FF;
    border-color: #7C3AED;
}

.image-gallery {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 12px;
    margin-top: 16px;
}

.image-item {
    position: relative;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(15, 23, 42, 0.1);
    border: 1px solid #E2E8F0;
}

.image-item img {
    width: 100%;
    height: 180px;
    object-fit: cover;
}

.image-item .delete-btn {
    position: absolute;
    top: 8px;
    right: 8px;
    background: #EF4444;
    color: white;
    border: none;
    border-radius: 50%;
    width: 28px;
    height: 28px;
    cursor: pointer;
    font-size: 1.1em;
    box-shadow: 0 2px 8px rgba(239, 68, 68, 0.4);
    transition: all 0.3s ease;
}

.image-item .delete-btn:hover {
    box-shadow: 0 0 15px rgba(239, 68, 68, 0.7);
}

.image-date {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(30, 41, 59, 0.8);
    color: white;
    padding: 4px 8px;
    font-size: 0.8em;
    font-weight: 600;
}

/* ========================================
   REPORT SECTION
   ======================================== */

.report-section {
    margin-bottom: 20px;
    padding-bottom: 16px;
    border-bottom: 2px solid #E2E8F0;
}

.report-section:last-child {
    border-bottom: none;
}

.report-section h3 {
    color: #7C3AED;
    margin-bottom: 12px;
    font-size: 1.1em;
    font-weight: 700;
}

.report-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 12px;
}

.report-stat {
    background: #F8FAFC;
    padding: 12px;
    border-radius: 8px;
    text-align: center;
    border: 1px solid #E2E8F0;
}

.report-stat-value {
    font-size: 1.8em;
    font-weight: 800;
    color: #7C3AED;
}

.report-stat-label {
    color: #64748B;
    font-size: 0.85em;
    font-weight: 600;
    margin-top: 4px;
}

/* ========================================
   CHARTS - CLEAN CONTAINER
   ======================================== */

.chart-container {
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(15, 23, 42, 0.06);
    margin: 16px 0;
    border: 1px solid rgba(124, 58, 237, 0.1);
}

.chart-container h3 {
    color: #7C3AED;
    font-size: 1.2em;
    margin-bottom: 16px;
    text-align: center;
    font-weight: 700;
}

.chart-wrapper {
    position: relative;
    height: 280px;
    margin: 0 auto;
}

.chart-empty-state {
    text-align: center;
    padding: 50px 20px;
    color: #94A3B8;
}

.chart-empty-state svg {
    width: 70px;
    height: 70px;
    margin-bottom: 12px;
    opacity: 0.3;
}

/* ========================================
   GRID UTILITIES
   ======================================== */

.grid-2 {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
}

.mini-calendar {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 4px;
    margin-top: 12px;
}

.mini-calendar-day {
    aspect-ratio: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: #F8FAFC;
    border-radius: 4px;
    font-size: 0.75em;
    padding: 2px;
    border: 1px solid #E2E8F0;
    font-weight: 600;
}

.mini-calendar-day.active {
    background: linear-gradient(135deg, #10B981, #059669);
    color: white;
    box-shadow: 0 0 8px rgba(16, 185, 129, 0.4);
}

/* ========================================
   RESPONSIVIDADE MOBILE
   ======================================== */

@media (max-width: 768px) {
    body {
        padding: 10px;
    }

    header {
        padding: 16px 18px;
    }

    h1 {
        font-size: 1.5em;
    }

    .subtitle {
        font-size: 0.9em;
    }

    .xp-container {
        padding: 16px;
    }

    .rank-badge {
        padding: 8px 18px;
        font-size: 1em;
    }

    .xp-bars {
        grid-template-columns: 1fr;
    }

    .dashboard {
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
    }

    .stat-card {
        padding: 14px;
    }

    .stat-value {
        font-size: 1.8em;
    }

    .tabs {
        gap: 6px;
    }

    .tab-button {
        padding: 9px 14px;
        font-size: 0.85em;
        flex: 1;
        min-width: calc(50% - 3px);
    }

    .tab-content {
        padding: 16px;
    }

    .section-title {
        font-size: 1.3em;
    }

    input[type="number"],
    input[type="text"],
    input[type="date"],
    select,
    textarea {
        font-size: 16px;
    }

    .btn {
        padding: 11px 18px;
        font-size: 0.9em;
        width: 100%;
    }

    .grid-2 {
        grid-template-columns: 1fr;
    }

    .calendar {
        gap: 6px;
    }

    .calendar-day {
        font-size: 0.75em;
        padding: 3px;
        min-height: 48px;
    }

    .chart-wrapper {
        height: 240px;
    }

    .image-gallery {
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
    }

    .report-stats {
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
    }
}
.report .calendar-day > div:first-child {
    font-size: 1.5em;   /* N√öMERO DO DIA */
    font-weight: 700;
}

.report .calendar-icons {
    font-size: 1.3em;   /* √çCONES */
}

.report .calendar-xp {
    font-size: 0.85em;
    font-weight: 700;
}

@media (max-width: 375px) {
    h1 {
        font-size: 1.3em;
    }

    .dashboard {
        grid-template-columns: 1fr;
    }

    .stat-value {
        font-size: 1.6em;
    }

    .tab-button {
        min-width: 100%;
    }
}

@media (min-width: 769px) {

    .calendar {
        gap: 5px;
    }

    .calendar-day {
        aspect-ratio: auto !important; /* üî• ISSO resolve */
        height: 100px !important;       /* controla o tamanho real */
        min-height: unset !important;
        font-size: 1.10em;
        padding: 1px;
    }

    .calendar-icons {
        font-size: 1.10em;
    }

    .calendar-xp {
        font-size: 1.10em;
    }
}
/* ========================================
   PLAYLIST CARD - NOVO
   ======================================== */

.playlist-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 24px;
    border-radius: 12px;
    margin-bottom: 20px;
    text-align: center;
    color: white;
    box-shadow: 0 4px 16px rgba(102, 126, 234, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.playlist-icon {
    font-size: 3em;
    margin-bottom: 12px;
}

.playlist-title {
    font-size: 1.4em;
    font-weight: 700;
    margin-bottom: 10px;
    color: white;
}

.playlist-description {
    font-size: 0.95em;
    margin-bottom: 18px;
    opacity: 0.95;
    line-height: 1.5;
}

.playlist-button {
    display: inline-block;
    background: white;
    color: #667eea;
    padding: 12px 28px;
    border-radius: 8px;
    font-weight: 700;
    font-size: 0.95em;
    text-decoration: none;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

.playlist-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 0 25px rgba(255, 255, 255, 0.5),
                0 8px 20px rgba(0, 0, 0, 0.3);
    background: #f8f9fd;
}

/* Responsividade Mobile */
@media (max-width: 768px) {
    .playlist-card {
        padding: 20px 16px;
    }
    
    .playlist-title {
        font-size: 1.2em;
    }
    
    .playlist-description {
        font-size: 0.9em;
    }
    
    .playlist-button {
        padding: 11px 22px;
        font-size: 0.9em;
        width: 100%;
    }
}

/* ========================================
   PAINEL DE PATENTES - NOVO
   ======================================== */

.ranks-panel {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1000;
    max-width: 280px;
}

.ranks-toggle {
    background: linear-gradient(135deg, #7C3AED, #6366F1);
    color: white;
    padding: 10px 18px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 700;
    font-size: 0.9em;
    box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3);
    transition: all 0.3s ease;
    text-align: center;
    user-select: none;
}

.ranks-toggle:hover {
    transform: translateY(-2px);
    box-shadow: 0 0 20px rgba(124, 58, 237, 0.5),
                0 6px 16px rgba(124, 58, 237, 0.4);
}

.ranks-content {
    display: none;
    background: white;
    margin-top: 10px;
    border-radius: 10px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
    overflow: hidden;
    border: 1px solid rgba(124, 58, 237, 0.1);
}

.ranks-panel.open .ranks-content {
    display: block;
    animation: slideDown 0.3s ease;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.ranks-header {
    background: linear-gradient(135deg, #F8F9FD, #E8EBF7);
    padding: 14px 16px;
    border-bottom: 2px solid #E2E8F0;
}

.ranks-header h4 {
    margin: 0;
    color: #7C3AED;
    font-size: 1em;
    font-weight: 700;
}

.ranks-list {
    max-height: 400px;
    overflow-y: auto;
    padding: 8px 0;
}

.rank-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 16px;
    transition: background 0.2s ease;
}

.rank-item:hover {
    background: #F8FAFC;
}

.rank-name {
    color: #1E293B;
    font-weight: 600;
    font-size: 0.9em;
}

.rank-xp {
    color: #7C3AED;
    font-weight: 700;
    font-size: 0.85em;
    background: rgba(124, 58, 237, 0.1);
    padding: 4px 10px;
    border-radius: 12px;
}

/* Scrollbar personalizada */
.ranks-list::-webkit-scrollbar {
    width: 6px;
}

.ranks-list::-webkit-scrollbar-track {
    background: #F1F5F9;
}

.ranks-list::-webkit-scrollbar-thumb {
    background: #CBD5E1;
    border-radius: 3px;
}

.ranks-list::-webkit-scrollbar-thumb:hover {
    background: #94A3B8;
}

/* Responsividade Mobile */
@media (max-width: 768px) {
    .ranks-panel {
        top: 10px;
        right: 10px;
        max-width: 260px;
    }
    
    .ranks-toggle {
        padding: 9px 14px;
        font-size: 0.85em;
    }
    
    .ranks-list {
        max-height: 300px;
    }
    
    .rank-item {
        padding: 9px 12px;
    }
    
    .rank-name {
        font-size: 0.85em;
    }
    
    .rank-xp {
        font-size: 0.8em;
        padding: 3px 8px;
    }
}
/* ========================================
   PAINEL DE PATENTES - NOVO
   ======================================== */

.ranks-panel {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1000;
    max-width: 280px;
}

.ranks-toggle {
    background: linear-gradient(135deg, #7C3AED, #6366F1);
    color: white;
    padding: 10px 18px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 700;
    font-size: 0.9em;
    box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3);
    transition: all 0.3s ease;
    text-align: center;
    user-select: none;
}

.ranks-toggle:hover {
    transform: translateY(-2px);
    box-shadow: 0 0 20px rgba(124, 58, 237, 0.5),
                0 6px 16px rgba(124, 58, 237, 0.4);
}

.ranks-content {
    display: none;
    background: white;
    margin-top: 10px;
    border-radius: 10px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
    overflow: hidden;
    border: 1px solid rgba(124, 58, 237, 0.1);
}

.ranks-panel.open .ranks-content {
    display: block;
    animation: slideDown 0.3s ease;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.ranks-header {
    background: linear-gradient(135deg, #F8F9FD, #E8EBF7);
    padding: 14px 16px;
    border-bottom: 2px solid #E2E8F0;
}

.ranks-header h4 {
    margin: 0;
    color: #7C3AED;
    font-size: 1em;
    font-weight: 700;
}

.ranks-list {
    max-height: 400px;
    overflow-y: auto;
    padding: 8px 0;
}

.rank-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 16px;
    transition: background 0.2s ease;
}

.rank-item:hover {
    background: #F8FAFC;
}

.rank-name {
    color: #1E293B;
    font-weight: 600;
    font-size: 0.9em;
}

.rank-xp {
    color: #7C3AED;
    font-weight: 700;
    font-size: 0.85em;
    background: rgba(124, 58, 237, 0.1);
    padding: 4px 10px;
    border-radius: 12px;
}

/* Scrollbar personalizada */
.ranks-list::-webkit-scrollbar {
    width: 6px;
}

.ranks-list::-webkit-scrollbar-track {
    background: #F1F5F9;
}

.ranks-list::-webkit-scrollbar-thumb {
    background: #CBD5E1;
    border-radius: 3px;
}

.ranks-list::-webkit-scrollbar-thumb:hover {
    background: #94A3B8;
}

/* Responsividade Mobile */
@media (max-width: 768px) {
    .ranks-panel {
        top: 10px;
        right: 10px;
        max-width: 260px;
    }
    
    .ranks-toggle {
        padding: 9px 14px;
        font-size: 0.85em;
    }
    
    .ranks-list {
        max-height: 300px;
    }
    
    .rank-item {
        padding: 9px 12px;
    }
    
    .rank-name {
        font-size: 0.85em;
    }
    
    .rank-xp {
        font-size: 0.8em;
        padding: 3px 8px;
    }
}
/* ========================================
   TELA DE LOGIN - NOVO
   ======================================== */

.login-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    padding: 20px;
}

.login-screen.hidden {
    display: none;
}

.login-container {
    max-width: 420px;
    width: 100%;
}

.login-header {
    text-align: center;
    color: white;
    margin-bottom: 24px;
}

.login-header h1 {
    font-size: 1.8em;
    margin-bottom: 8px;
    color: white;
}

.login-header p {
    font-size: 1em;
    opacity: 0.9;
}

.login-box {
    background: white;
    padding: 32px 28px;
    border-radius: 12px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
}

.login-box h2 {
    color: #1E293B;
    font-size: 1.5em;
    margin-bottom: 8px;
    text-align: center;
}

.login-subtitle {
    color: #64748B;
    text-align: center;
    margin-bottom: 24px;
    font-size: 0.9em;
}

.login-box .form-group {
    margin-bottom: 16px;
}

.login-box label {
    display: block;
    margin-bottom: 6px;
    color: #334155;
    font-weight: 600;
    font-size: 0.9em;
}

.login-box input {
    width: 100%;
    padding: 12px 14px;
    border: 1.5px solid #E2E8F0;
    border-radius: 8px;
    font-size: 0.95em;
    transition: all 0.3s ease;
    background: #F8FAFC;
}

.login-box input:focus {
    outline: none;
    border-color: #7C3AED;
    background: white;
    box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
}

.btn-login {
    width: 100%;
    margin-top: 8px;
    margin-bottom: 16px;
}

.btn-google {
    width: 100%;
    background: white;
    color: #1E293B;
    border: 1.5px solid #E2E8F0;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 16px;
}

.btn-google:hover {
    background: #F8FAFC;
    border-color: #CBD5E1;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.btn-offline {
    width: 100%;
    background: transparent;
    color: #64748B;
    border: 1.5px dashed #CBD5E1;
    box-shadow: none;
}

.btn-offline:hover {
    background: #F8FAFC;
    color: #475569;
    box-shadow: none;
}

.login-divider {
    text-align: center;
    position: relative;
    margin: 20px 0;
}

.login-divider::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    height: 1px;
    background: #E2E8F0;
}

.login-divider span {
    background: white;
    padding: 0 12px;
    position: relative;
    color: #94A3B8;
    font-size: 0.85em;
    font-weight: 600;
}

.login-toggle {
    text-align: center;
    color: #64748B;
    font-size: 0.9em;
    margin-top: 16px;
}

.login-toggle a {
    color: #7C3AED;
    font-weight: 600;
    text-decoration: none;
}

.login-toggle a:hover {
    text-decoration: underline;
}

.login-message {
    margin-top: 16px;
    padding: 12px;
    border-radius: 8px;
    font-size: 0.9em;
    text-align: center;
    display: none;
}

.login-message.show {
    display: block;
}

.login-message.error {
    background: rgba(239, 68, 68, 0.1);
    color: #DC2626;
    border: 1px solid rgba(239, 68, 68, 0.3);
}

.login-message.success {
    background: rgba(16, 185, 129, 0.1);
    color: #059669;
    border: 1px solid rgba(16, 185, 129, 0.3);
}

/* Mobile */
@media (max-width: 768px) {
    .login-box {
        padding: 24px 20px;
    }
    
    .login-header h1 {
        font-size: 1.5em;
    }
    
    .login-box h2 {
        font-size: 1.3em;
    }
}
/* ========================================
   USER INFO E LOGOUT - NOVO
   ======================================== */

.user-info-box {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 8px;
}

.user-email {
    font-size: 0.85em;
    color: #64748B;
    font-weight: 600;
    padding: 4px 8px;
    background: #F8FAFC;
    border-radius: 6px;
    border: 1px solid #E2E8F0;
}

.btn-logout {
    display: flex;
    align-items: center;
    gap: 6px;
    background: transparent;
    color: #EF4444;
    border: 1.5px solid #FEE2E2;
    padding: 8px 14px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.85em;
    font-weight: 600;
    transition: all 0.3s ease;
    font-family: inherit;
}

.btn-logout:hover {
    background: #FEE2E2;
    color: #DC2626;
    border-color: #FECACA;
    box-shadow: 0 2px 8px rgba(239, 68, 68, 0.2);
    transform: translateY(-1px);
}

.btn-logout svg {
    width: 16px;
    height: 16px;
}

/* Mobile */
@media (max-width: 768px) {
    header > div {
        flex-direction: column !important;
        gap: 12px;
    }
    
    .user-info-box {
        align-items: center;
        width: 100%;
    }
    
    .user-email {
        font-size: 0.8em;
    }
    
    .btn-logout {
        width: 100%;
        justify-content: center;
        font-size: 0.9em;
    }
}
    </style>
    <!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
</head>
<body>
    <!-- üîê TELA DE LOGIN - NOVO -->
<div id="loginScreen" class="login-screen">
    <div class="login-container">
        <div class="login-header">
            <h1>üè• Acompanhamento Terap√™utico</h1>
            <p>Pectus Excavatum</p>
        </div>
        
        <div class="login-box">
            <h2>Bem-vindo de volta!</h2>
            <p class="login-subtitle">Entre para acessar seu progresso</p>
            
            <div id="loginForm">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="loginEmail" placeholder="seu@email.com" autocomplete="email">
                </div>
                
                <div class="form-group">
                    <label>Senha</label>
                    <input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password">
                </div>
                
                <button class="btn btn-login" onclick="handleLogin()">Entrar</button>
                
                <div class="login-divider">
                    <span>ou</span>
                </div>
                
                <button class="btn btn-google" onclick="handleGoogleLogin()">
                    <svg width="18" height="18" viewBox="0 0 18 18" style="margin-right: 8px;">
                        <path fill="#4285F4" d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.874 2.684-6.615z"/>
                        <path fill="#34A853" d="M9 18c2.43 0 4.467-.806 5.956-2.184l-2.908-2.258c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.711H.957v2.332C2.438 15.983 5.482 18 9 18z"/>
                        <path fill="#FBBC05" d="M3.964 10.707c-.18-.54-.282-1.117-.282-1.707s.102-1.167.282-1.707V4.961H.957C.347 6.175 0 7.55 0 9s.348 2.825.957 4.039l3.007-2.332z"/>
                        <path fill="#EA4335" d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0 5.482 0 2.438 2.017.957 4.961L3.964 7.29C4.672 5.163 6.656 3.58 9 3.58z"/>
                    </svg>
                    Entrar com Google
                </button>
                
                <p class="login-toggle">
                    N√£o tem conta? <a href="#" onclick="toggleAuthMode(); return false;">Criar conta</a>
                </p>
            </div>
            
            <div id="registerForm" style="display: none;">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="registerEmail" placeholder="seu@email.com" autocomplete="email">
                </div>
                
                <div class="form-group">
                    <label>Senha (m√≠nimo 6 caracteres)</label>
                    <input type="password" id="registerPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="new-password">
                </div>
                
                <button class="btn btn-login" onclick="handleRegister()">Criar Conta</button>
                
                <p class="login-toggle">
                    J√° tem conta? <a href="#" onclick="toggleAuthMode(); return false;">Entrar</a>
                </p>
            </div>
        </div>
        
        <div id="loginMessage" class="login-message"></div>
    </div>
</div>
    <!-- üèÜ PAINEL DE PATENTES - NOVO -->
<div class="ranks-panel">
    <div class="ranks-toggle" onclick="this.parentElement.classList.toggle('open')">
        üèÜ Patentes
    </div>
    <div class="ranks-content">
        <div class="ranks-header">
            <h4>üéñÔ∏è Sistema de Patentes</h4>
        </div>
        <div class="ranks-list">
            <div class="rank-item">
                <span class="rank-name">Iniciante Consciente</span>
                <span class="rank-xp">0 XP</span>
            </div>
            <div class="rank-item">
                <span class="rank-name">Em Adapta√ß√£o</span>
                <span class="rank-xp">100 XP</span>
            </div>
            <div class="rank-item">
                <span class="rank-name">Persistente</span>
                <span class="rank-xp">300 XP</span>
            </div>
            <div class="rank-item">
                <span class="rank-name">Disciplinado</span>
                <span class="rank-xp">600 XP</span>
            </div>
            <div class="rank-item">
                <span class="rank-name">Resiliente</span>
                <span class="rank-xp">1000 XP</span>
            </div>
            <div class="rank-item">
                <span class="rank-name">Constante</span>
                <span class="rank-xp">1500 XP</span>
            </div>
            <div class="rank-item">
                <span class="rank-name">Evoluindo</span>
                <span class="rank-xp">2200 XP</span>
            </div>
            <div class="rank-item">
                <span class="rank-name">Fortalecido</span>
                <span class="rank-xp">3000 XP</span>
            </div>
            <div class="rank-item">
                <span class="rank-name">Refer√™ncia</span>
                <span class="rank-xp">4000 XP</span>
            </div>
            <div class="rank-item">
                <span class="rank-name">Em Equil√≠brio</span>
                <span class="rank-xp">5500 XP</span>
            </div>
        </div>
    </div>
</div>
    <div class="container">
        <header>
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
            <h1>üè• Acompanhamento Terap√™utico</h1>
            <p class="subtitle">Sistema de Monitoramento - Pectus Excavatum</p>
        </div>
        <div id="userInfoContainer" style="display: none;">
            <div class="user-info-box">
                <div class="user-email" id="userEmail">usuario@email.com</div>
                <button class="btn-logout" onclick="handleLogout()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                        <polyline points="16 17 21 12 16 7"></polyline>
                        <line x1="21" y1="12" x2="9" y2="12"></line>
                    </svg>
                    Sair
                </button>
            </div>
        </div>
    </div>
</header>

        <div class="xp-container">
            <div class="rank-display">
                <div class="rank-badge" id="rankBadge">Iniciante Consciente</div>
            </div>
            <div class="xp-bars">
                <div class="xp-bar-container">
                    <div class="xp-bar-label">
                        <span>ü´Å Tratamento</span>
                        <span id="xpTratamentoText">0 XP</span>
                    </div>
                    <div class="xp-bar">
                        <div class="xp-bar-fill" id="xpTratamentoBar" style="width: 0%"></div>
                    </div>
                </div>
                <div class="xp-bar-container">
                    <div class="xp-bar-label">
                        <span>üí™ Corpo</span>
                        <span id="xpCorpoText">0 XP</span>
                    </div>
                    <div class="xp-bar">
                        <div class="xp-bar-fill" id="xpCorpoBar" style="width: 0%"></div>
                    </div>
                </div>
                <div class="xp-bar-container">
                    <div class="xp-bar-label">
                        <span>üçΩÔ∏è Cuidado</span>
                        <span id="xpCuidadoText">0 XP</span>
                    </div>
                    <div class="xp-bar">
                        <div class="xp-bar-fill" id="xpCuidadoBar" style="width: 0%"></div>
                    </div>
                </div>
                <div class="xp-bar-container">
                    <div class="xp-bar-label">
                        <span>‚≠ê XP Geral</span>
                        <span id="xpGeralText">0 XP</span>
                    </div>
                    <div class="xp-bar">
                        <div class="xp-bar-fill" id="xpGeralBar" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="messageContainer"></div>

        <div class="dashboard">
            <div class="stat-card">
                <h3>Vacuum Bell</h3>
                <div class="stat-value" id="totalVacuumDays">0</div>
                <div class="stat-label">dias de uso</div>
            </div>
            <div class="stat-card">
                <h3>Tempo Di√°rio</h3>
                <div class="stat-value" id="currentTime">5</div>
                <div class="stat-label">minutos hoje</div>
            </div>
            <div class="stat-card">
                <h3>Academia</h3>
                <div class="stat-value" id="totalWorkoutDays">0</div>
                <div class="stat-label">dias treinados</div>
            </div>
            <div class="stat-card">
                <h3>Peso Atual</h3>
                <div class="stat-value" id="currentWeight">--</div>
                <div class="stat-label">kg</div>
            </div>
        </div>
            <div class="stat-card">
                <h3>üî• Sequ√™ncia Atual</h3>
                <div class="stat-value" id="streakAtualValue">0</div>
                <div class="stat-label">dias consecutivos</div>
        </div>
    <div class="stat-card">
        <h3>üèÜ Maior Sequ√™ncia</h3>
        <div class="stat-value" id="maiorStreakValue">0</div>
        <div class="stat-label">recorde pessoal</div>
    </div>
</div>
        <div class="tabs">
            <button class="tab-button active" onclick="openTab('vacuum')">Vacuum Bell</button>
            <button class="tab-button" onclick="openTab('workout')">Academia</button>
            <button class="tab-button" onclick="openTab('care')">Cuidado Di√°rio</button>
            <button class="tab-button" onclick="openTab('weight')">Peso</button>
            <button class="tab-button" onclick="openTab('measurement')">Medi√ß√£o Pectus</button>
            <button class="tab-button" onclick="openTab('photos')">Fotos</button>
            <button class="tab-button" onclick="openTab('report')">üìä Relat√≥rio</button>
        </div>

        <div id="vacuum" class="tab-content active">
            <h2 class="section-title">üí® Uso do Vacuum Bell</h2>
            
            <div class="info-box">
                <strong>‚ÑπÔ∏è Como funciona:</strong> O tempo de uso aumenta 5 minutos por semana at√© atingir o tempo m√°ximo configurado.
            </div>

            <div class="grid-2">
                <div class="form-group">
                    <label>Semana Atual do Tratamento</label>
                    <select id="vacuumWeek" onchange="updateVacuumTime()">
                        <option value="1">Semana 1 - 5 minutos</option>
                        <option value="2">Semana 2 - 10 minutos</option>
                        <option value="3">Semana 3 - 15 minutos</option>
                        <option value="4">Semana 4 - 20 minutos</option>
                        <option value="5">Semana 5 - 25 minutos</option>
                        <option value="6">Semana 6 - 30 minutos</option>
                        <option value="7">Semana 7 - 35 minutos</option>
                        <option value="8">Semana 8 - 40 minutos</option>
                        <option value="9">Semana 9 - 45 minutos</option>
                        <option value="10">Semana 10 - 50 minutos</option>
                        <option value="11">Semana 11 - 55 minutos</option>
                        <option value="12">Semana 12 - 60 minutos</option>
                        <option value="13">Semana 13 - 65 minutos</option>
                        <option value="14">Semana 14 - 70 minutos</option>
                        <option value="15">Semana 15 - 75 minutos</option>
                        <option value="16">Semana 16+ - 80 minutos</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Tempo M√°ximo (minutos)</label>
                    <select id="vacuumMaxTime" onchange="updateVacuumTime()">
                        <option value="60">1 hora (60 minutos)</option>
                        <option value="80">1h 20min (80 minutos)</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label>Dias J√° Utilizados Anteriormente</label>
                <input type="number" id="previousDays" min="0" placeholder="Ex: 90 dias (3 meses)">
                <button class="btn" onclick="addPreviousDays()" style="margin-top: 10px;">Adicionar Dias Anteriores</button>
            </div>

            <div class="form-group">
                <label>
                    <input type="checkbox" id="noPainCheckbox"> 
                    Usei sem dor ou desconforto (+5 XP b√¥nus)
                </label>
            </div>

            <div class="form-group">
                <label>Observa√ß√µes de Hoje</label>
                <textarea id="vacuumNotes" placeholder="Dor, conforto, resultados observados..."></textarea>
            </div>

            <button class="btn btn-success" onclick="checkInVacuum()">‚úÖ Registrar Uso de Hoje</button>

            <div class="month-selector">
                <button onclick="changeVacuumMonth(-1)">‚Üê Anterior</button>
                <span id="vacuumMonthLabel"></span>
                <button onclick="changeVacuumMonth(1)">Pr√≥ximo ‚Üí</button>
            </div>

            <div class="calendar" id="vacuumCalendar"></div>

            <!-- GR√ÅFICO DE USO MENSAL DO VACUUM - NOVO -->
<div class="chart-container">
    <h3>üìä Uso Mensal do Vacuum Bell</h3>
    <div class="chart-wrapper">
        <canvas id="chartVacuum"></canvas>
    </div>
</div>

<h3 style="margin-top: 30px; color: #667eea;">üìä Hist√≥rico</h3>
<div id="vacuumHistory"></div>
        </div>

        <div id="workout" class="tab-content">
            <h2 class="section-title">üí™ Academia - Treino Di√°rio</h2>

            <div class="form-group">
                <label>Treino de Hoje</label>
                <select id="workoutType">
                    <option value="">Selecione o treino</option>
                    <option value="Peito e Tr√≠ceps">Dia 1 - Peito e Tr√≠ceps</option>
                    <option value="Costas e B√≠ceps">Dia 2 - Costas e B√≠ceps</option>
                    <option value="Ombros e Abd√¥men">Dia 3 - Ombros e Abd√¥men</option>
                    <option value="Pernas e Gl√∫teos">Dia 4 - Pernas e Gl√∫teos</option>
                </select>
            </div>

            <div class="form-group">
                <label>Observa√ß√µes do Treino</label>
                <textarea id="workoutNotes" placeholder="Carga utilizada, intensidade, dores, sensa√ß√µes..."></textarea>
            </div>

            <button class="btn btn-success" onclick="checkInWorkout()">‚úÖ Registrar Treino de Hoje</button>

            <div class="month-selector">
                <button onclick="changeWorkoutMonth(-1)">‚Üê Anterior</button>
                <span id="workoutMonthLabel"></span>
                <button onclick="changeWorkoutMonth(1)">Pr√≥ximo ‚Üí</button>
            </div>

            <div class="calendar" id="workoutCalendar"></div>

            <h3 style="margin-top: 30px; color: #667eea;">üìä Hist√≥rico</h3>
            <div id="workoutHistory"></div>
        </div>

        <div id="care" class="tab-content">
            <h2 class="section-title">üçΩÔ∏è Cuidado Di√°rio</h2>
            
            <div class="info-box">
                <strong>‚ÑπÔ∏è Cuidado pessoal:</strong> Marque quando voc√™ cuidar da sua alimenta√ß√£o, postura ou bem-estar geral.
            </div>

            <div class="daily-care">
                <div class="care-checkbox" onclick="toggleCareCheckbox()">
                    <input type="checkbox" id="careCheckbox">
                    <label for="careCheckbox" style="cursor: pointer; margin: 0;">
                        Hoje eu cuidei de mim (alimenta√ß√£o, postura, bem-estar)
                    </label>
                </div>
            </div>

            <div class="form-group">
                <label>üçΩÔ∏è O que comi hoje (opcional)</label>
                <textarea id="careFood" placeholder="Ex: Arroz, feij√£o, frango, salada..."></textarea>
            </div>

            <div class="form-group">
                <label>ü´Å Respira√ß√£o, alongamento ou autocuidado (opcional)</label>
                <textarea id="careSelfCare" placeholder="Ex: 10 minutos de respira√ß√£o, alongamento da coluna..."></textarea>
            </div>

            <button class="btn btn-success" onclick="checkInCare()">‚úÖ Registrar Cuidado de Hoje</button>

            <div class="month-selector">
                <button onclick="changeCareMonth(-1)">‚Üê Anterior</button>
                <span id="careMonthLabel"></span>
                <button onclick="changeCareMonth(1)">Pr√≥ximo ‚Üí</button>
            </div>

            <div class="calendar" id="careCalendar"></div>

            <h3 style="margin-top: 30px; color: #667eea;">üìä Hist√≥rico</h3>
            <div id="careHistory"></div>
        </div>

        <div id="weight" class="tab-content">
            <h2 class="section-title">‚öñÔ∏è Acompanhamento de Peso</h2>

            <div class="form-group">
                <label>Peso Atual (kg)</label>
                <input type="number" id="weightInput" step="0.1" placeholder="Ex: 70.5">
            </div>

            <button class="btn btn-success" onclick="saveWeight()">üíæ Salvar Peso</button>

            <h3 style="margin-top: 30px; color: #667eea;">üìä Evolu√ß√£o do Peso</h3>

            <!-- GR√ÅFICO DE PESO - NOVO -->
            <div class="chart-container">
            <h3>üìà Evolu√ß√£o do Peso</h3>
            <div class="chart-wrapper">
            <canvas id="chartPeso"></canvas>
            </div>
       </div>

<!-- Hist√≥rico em lista continua existindo -->
<h3 style="margin-top: 30px; color: #667eea;">üìã Hist√≥rico Detalhado</h3>
<div id="weightHistory"></div>
            
        </div>

        <div id="measurement" class="tab-content">
            <h2 class="section-title">üìè Medi√ß√£o do Pectus</h2>

            <div class="form-group">
                <label>Profundidade (cm)</label>
                <input type="number" id="pectusDepth" step="0.1" placeholder="Ex: 3.5">
            </div>

            <div class="form-group">
                <label>Observa√ß√µes</label>
                <textarea id="pectusNotes" placeholder="M√©todo de medi√ß√£o, local exato, percep√ß√µes..."></textarea>
            </div>

            <button class="btn btn-success" onclick="saveMeasurement()">üíæ Salvar Medi√ß√£o</button>

            <h3 style="margin-top: 30px; color: #667eea;">üìä Evolu√ß√£o das Medi√ß√µes</h3>

<!-- GR√ÅFICO DE PROFUNDIDADE PECTUS - NOVO -->
<div class="chart-container">
    <h3>üìâ Profundidade do Pectus ao Longo do Tempo</h3>
    <div class="chart-wrapper">
        <canvas id="chartPectus"></canvas>
    </div>
</div>

<!-- Hist√≥rico em lista continua existindo -->
<h3 style="margin-top: 30px; color: #667eea;">üìã Hist√≥rico Detalhado</h3>
<div id="measurementHistory"></div>
        </div>

        <div id="photos" class="tab-content">
            <h2 class="section-title">üì∏ Fotos de Progresso</h2>

            <div class="image-upload" onclick="document.getElementById('photoInput').click()">
                <p style="font-size: 3em;">üì∑</p>
                <p>Clique para adicionar foto</p>
                <p style="font-size: 0.9em; color: #666;">As fotos s√£o salvas localmente no seu navegador</p>
            </div>
            <input type="file" id="photoInput" accept="image/*" style="display: none;" onchange="addPhoto()">

            <div class="month-selector">
                <button onclick="changePhotoMonth(-1)">‚Üê Anterior</button>
                <span id="photoMonthLabel"></span>
                <button onclick="changePhotoMonth(1)">Pr√≥ximo ‚Üí</button>
            </div>

            <div class="image-gallery" id="photoGallery"></div>
        </div>

        <div id="report" class="tab-content">
            <h2 class="section-title">üìä Relat√≥rio Mensal</h2>
            
            <div class="month-selector">
                <button onclick="changeReportMonth(-1)">‚Üê Anterior</button>
                <span id="reportMonthLabel"></span>
                <button onclick="changeReportMonth(1)">Pr√≥ximo ‚Üí</button>
            </div>

            <div id="reportContent"></div>
        </div>
        <!-- üéØ CARD DE PLAYLIST - NOVO -->
<div class="playlist-card">
    <div class="playlist-icon">üé•</div>
    <h3 class="playlist-title">Exerc√≠cios para Pectus Excavatum</h3>
    <p class="playlist-description">
        Playlist completa com exerc√≠cios espec√≠ficos para fortalecer o t√≥rax e melhorar a postura.
    </p>
    <a href="https://youtube.com/playlist?list=PLFP6EYiyQK-GMLd1Wfd-fgOWpGhzLsHwN&si=7-ukLW6e4lLf7ekL" target="_blank" rel="noopener noreferrer" class="playlist-button">
        Acessar Playlist no YouTube ‚Üí
    </a>
</div>
    </div>

<!-- Chart.js CDN - ADICIONAR ANTES DO  PRINCIPAL -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <script>
        // ========================================
// FIREBASE CONFIGURATION - NOVO
// ========================================

// ‚ö†Ô∏è SUBSTITUA COM SUAS CREDENCIAIS DO FIREBASE
const firebaseConfig = {
  apiKey: "AIzaSyBWxCGa9U2m-jBZ12rAMxWWh_RYBDKZMyo",
  authDomain: "pectuscheck.firebaseapp.com",
  databaseURL: "https://pectuscheck-default-rtdb.firebaseio.com",
  projectId: "pectuscheck",
  storageBucket: "pectuscheck.firebasestorage.app",
  messagingSenderId: "261580913188",
  appId: "1:261580913188:web:9c496e2967375f7d9036b1",
};

// Inicializar Firebase
let firebaseApp, firebaseAuth, firebaseDatabase;
let currentUser = null;
let isOnlineMode = false;

try {
    firebaseApp = firebase.initializeApp(firebaseConfig);
    firebaseAuth = firebase.auth();
    firebaseDatabase = firebase.database();
} catch (error) {
    console.error("Erro ao inicializar Firebase:", error);
}

// ========================================
// FUN√á√ïES DE AUTENTICA√á√ÉO - NOVO
// ========================================

function showLoginMessage(message, type = 'error') {
    const messageEl = document.getElementById('loginMessage');
    messageEl.textContent = message;
    messageEl.className = `login-message show ${type}`;
    setTimeout(() => {
        messageEl.classList.remove('show');
    }, 4000);
}

function toggleAuthMode() {
    const loginForm = document.getElementById('loginForm');
    const registerForm = document.getElementById('registerForm');
    
    if (loginForm.style.display === 'none') {
        loginForm.style.display = 'block';
        registerForm.style.display = 'none';
    } else {
        loginForm.style.display = 'none';
        registerForm.style.display = 'block';
    }
}

async function handleLogin() {
    const email = document.getElementById('loginEmail').value.trim();
    const password = document.getElementById('loginPassword').value;
    
    if (!email || !password) {
        showLoginMessage('Preencha todos os campos!');
        return;
    }
    
    try {
        const userCredential = await firebaseAuth.signInWithEmailAndPassword(email, password);
        currentUser = userCredential.user;
        isOnlineMode = true;
        await loadUserData();
        hideLoginScreen();
        showMessage('‚úÖ Login realizado com sucesso!', 'success');
    } catch (error) {
        console.error(error);
        showLoginMessage(getErrorMessage(error.code));
    }
}

async function handleRegister() {
    const email = document.getElementById('registerEmail').value.trim();
    const password = document.getElementById('registerPassword').value;
    
    if (!email || !password) {
        showLoginMessage('Preencha todos os campos!');
        return;
    }
    
    if (password.length < 6) {
        showLoginMessage('A senha deve ter no m√≠nimo 6 caracteres!');
        return;
    }
    
    try {
        const userCredential = await firebaseAuth.createUserWithEmailAndPassword(email, password);
        currentUser = userCredential.user;
        isOnlineMode = true;
        await saveUserData();
        hideLoginScreen();
        showMessage('‚úÖ Conta criada com sucesso!', 'success');
    } catch (error) {
        console.error(error);
        showLoginMessage(getErrorMessage(error.code));
    }
}

async function handleGoogleLogin() {
    try {
        const provider = new firebase.auth.GoogleAuthProvider();
        const userCredential = await firebaseAuth.signInWithPopup(provider);
        currentUser = userCredential.user;
        isOnlineMode = true;
        await loadUserData();
        hideLoginScreen();
        showMessage('‚úÖ Login com Google realizado!', 'success');
    } catch (error) {
        console.error(error);
        showLoginMessage(getErrorMessage(error.code));
    }
}

function continueOffline() {
    showLoginMessage('‚ö†Ô∏è Modo offline foi desativado. Fa√ßa login para continuar.', 'warning');
}

function hideLoginScreen() {
    document.getElementById('loginScreen').classList.add('hidden');
    showUserInfo(); // ‚Üê ADICIONAR ESTA LINHA
    init(); // Inicializar o app
}
async function handleLogout() {
    // 1Ô∏è‚É£ Perguntar se tem certeza
    if (!confirm('Tem certeza que deseja sair?\n\nSeus dados j√° foram sincronizados.')) {
        return;
    }
    
    try {
        // 2Ô∏è‚É£ Salvar uma √∫ltima vez antes de sair
        if (isOnlineMode) {
            await saveUserData();
        }
        
        // 3Ô∏è‚É£ Fazer logout do Firebase
        await firebaseAuth.signOut();
        
        // 4Ô∏è‚É£ LIMPAR TODAS AS VARI√ÅVEIS (IMPORTANTE!)
        currentUser = null;
        isOnlineMode = false;
        
        // Zerar todos os dados
        vacuumData = {};
        workoutData = {};
        careData = {};
        weightData = [];
        measurementData = [];
        photoData = [];
        settings = { vacuumWeek: 1, vacuumMaxTime: 60, previousDaysAdded: 0 };
        xpData = { xpTratamento: 0, xpCorpo: 0, xpCuidado: 0, xpGeral: 0, lastActivity: null };
        streakData = { streakAtual: 0, maiorStreak: 0, ultimoDiaAtivo: null, diasPausados: 0, streak7Bonus: false };
        
        // 5Ô∏è‚É£ Esconder informa√ß√µes do usu√°rio
        document.getElementById('userInfoContainer').style.display = 'none';
        
        // 6Ô∏è‚É£ Mostrar tela de login novamente
        document.getElementById('loginScreen').classList.remove('hidden');
        
        // 7Ô∏è‚É£ Limpar campos de login
        document.getElementById('loginEmail').value = '';
        document.getElementById('loginPassword').value = '';
        document.getElementById('registerEmail').value = '';
        document.getElementById('registerPassword').value = '';
        
        showLoginMessage('‚úÖ Logout realizado com sucesso!', 'success');
        
    } catch (error) {
        console.error('Erro ao fazer logout:', error);
        showMessage('‚ùå Erro ao fazer logout. Tente novamente.', 'error');
    }
}

function showUserInfo() {
    if (isOnlineMode && currentUser) {
        const container = document.getElementById('userInfoContainer');
        const emailEl = document.getElementById('userEmail');
        
        emailEl.textContent = currentUser.email;
        container.style.display = 'block';
    }
}
function getErrorMessage(code) {
    const messages = {
        'auth/user-not-found': 'Usu√°rio n√£o encontrado',
        'auth/wrong-password': 'Senha incorreta',
        'auth/email-already-in-use': 'Este email j√° est√° em uso',
        'auth/weak-password': 'Senha muito fraca',
        'auth/invalid-email': 'Email inv√°lido',
        'auth/popup-closed-by-user': 'Login cancelado',
        'auth/network-request-failed': 'Erro de conex√£o'
    };
    return messages[code] || 'Erro ao fazer login. Tente novamente.';
}

// ========================================
// SINCRONIZA√á√ÉO DE DADOS - NOVO
// ========================================

async function saveUserData() {
    // 1Ô∏è‚É£ Verificar se est√° logado
    if (!isOnlineMode || !currentUser) {
        return; // Se n√£o estiver logado, n√£o faz nada
    }
    
    try {
        // 2Ô∏è‚É£ Pegar o UID (ID √∫nico) do usu√°rio logado
        const userId = currentUser.uid;
        
        // 3Ô∏è‚É£ Salvar TUDO no Firebase organizado por UID
        await firebaseDatabase.ref(`users/${userId}`).set({
            vacuumData: vacuumData,           // Calend√°rio do Vacuum
            workoutData: workoutData,         // Calend√°rio da Academia
            careData: careData,               // Calend√°rio do Cuidado
            weightData: weightData,           // Hist√≥rico de peso
            measurementData: measurementData, // Medi√ß√µes do pectus
            photoData: photoData,             // Fotos de progresso
            settings: settings,               // Configura√ß√µes (semana, tempo)
            xpData: xpData,                   // XP e patente
            streakData: streakData,           // Sequ√™ncia de dias
            lastSync: new Date().toISOString() // Data da √∫ltima sincroniza√ß√£o
        });
        
        console.log('‚úÖ Dados salvos no Firebase!');
        
    } catch (error) {
        console.error('‚ùå Erro ao salvar:', error);
    }
}

// ========================================
// CARREGAR DADOS DO FIREBASE POR USU√ÅRIO
// ========================================

async function loadUserData() {
    // 1Ô∏è‚É£ Verificar se est√° logado
    if (!isOnlineMode || !currentUser) {
        return;
    }
    
    try {
        // 2Ô∏è‚É£ Pegar o UID do usu√°rio logado
        const userId = currentUser.uid;
        
        // 3Ô∏è‚É£ Buscar dados do Firebase usando o UID
        const snapshot = await firebaseDatabase.ref(`users/${userId}`).once('value');
        const data = snapshot.val();
        
        // 4Ô∏è‚É£ Se encontrou dados salvos, usar eles
        if (data) {
            vacuumData = data.vacuumData || {};
            workoutData = data.workoutData || {};
            careData = data.careData || {};
            weightData = data.weightData || [];
            measurementData = data.measurementData || [];
            photoData = data.photoData || [];
            settings = data.settings || { vacuumWeek: 1, vacuumMaxTime: 60, previousDaysAdded: 0 };
            xpData = data.xpData || { xpTratamento: 0, xpCorpo: 0, xpCuidado: 0, xpGeral: 0, lastActivity: formatDate(new Date()) };
            streakData = data.streakData || { streakAtual: 0, maiorStreak: 0, ultimoDiaAtivo: null, diasPausados: 0, streak7Bonus: false };
            
            console.log('‚úÖ Dados carregados do Firebase!');
        } else {
            // 5Ô∏è‚É£ Se n√£o encontrou dados, √© primeira vez = come√ßar zerado
            console.log('‚ÑπÔ∏è Primeira vez logando - dados zerados');
        }
        
    } catch (error) {
        console.error('‚ùå Erro ao carregar:', error);
    }
}
  
let vacuumData = {};
let workoutData = {};
let careData = {};
let weightData = [];
let measurementData = [];
let photoData = [];
let settings = {
    vacuumWeek: 1,
    vacuumMaxTime: 60,
    previousDaysAdded: 0
};

// ‚úÖ CORRE√á√ÉO: N√£o chamar fun√ß√µes na inicializa√ß√£o
let xpData = {
    xpTratamento: 0,
    xpCorpo: 0,
    xpCuidado: 0,
    xpGeral: 0,
    lastActivity: null  // Ser√° definido depois
};

let streakData = {
    streakAtual: 0,
    maiorStreak: 0,
    ultimoDiaAtivo: null,
    diasPausados: 0,
    streak7Bonus: false
};
        // PATENTES
        const ranks = [
            { name: 'Iniciante Consciente', xp: 0 },
            { name: 'Em Adapta√ß√£o', xp: 100 },
            { name: 'Persistente', xp: 300 },
            { name: 'Disciplinado', xp: 600 },
            { name: 'Resiliente', xp: 1000 },
            { name: 'Constante', xp: 1500 },
            { name: 'Evoluindo', xp: 2200 },
            { name: 'Fortalecido', xp: 3000 },
            { name: 'Refer√™ncia', xp: 4000 },
            { name: 'Em Equil√≠brio', xp: 5500 }
        ];

        let currentVacuumMonth = new Date();
        let currentWorkoutMonth = new Date();
        let currentCareMonth = new Date();
        let currentPhotoMonth = new Date();
        let currentReportMonth = new Date();

        // ========================================
        // UTILIT√ÅRIOS
        // ========================================
        function parseLocalDate(dateStr) {
    const [year, month, day] = dateStr.split('-').map(Number);
    return new Date(year, month - 1, day);
}

function formatDate(date) {
    const d = new Date(date);
    const day = String(d.getDate()).padStart(2, '0');
    const month = String(d.getMonth() + 1).padStart(2, '0');
    const year = d.getFullYear();
    return `${year}-${month}-${day}`;
}

function getMonthName(date) {
    const months = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho',
                  'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
    return `${months[date.getMonth()]} ${date.getFullYear()}`;
}

// ========================================
// INICIALIZAR lastActivity AP√ìS formatDate ESTAR DEFINIDO
// ========================================

// Definir lastActivity corretamente
if (!xpData.lastActivity) {
    xpData.lastActivity = formatDate(new Date());
}

        function openTab(tabName) {
            const tabs = document.querySelectorAll('.tab-content');
            const buttons = document.querySelectorAll('.tab-button');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            buttons.forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            if (tabName === 'report') {
                generateMonthlyReport();
            }
        }
// ========================================
// SISTEMA DE MENSAGENS MOTIVACIONAIS - NOVO
// ========================================

/**
 * Biblioteca de mensagens motivacionais organizadas por contexto
 */
const motivationalMessages = {
    // Mensagens de boas-vindas (quando abre o site pela primeira vez no dia)
    boasVindas: [
        "Oi! Que bom te ver por aqui hoje! üòä",
        "Bem-vindo de volta! Pronto para mais um dia? üí™",
        "E a√≠! Bora cuidar de voc√™ hoje? ‚ú®",
        "Ol√°! Seu progresso est√° te esperando üåü",
        "Que bom que voc√™ voltou! Vamos juntos hoje ü§ó",
        "Opa! Chegou a hora de se cuidar üíô"
    ],
    
    // Mensagens quando h√° 1 dia sem registro (tom leve e sem press√£o)
    umDiaSemAtividade: [
        "Ei, tudo bem por a√≠? Ontem voc√™ n√£o apareceu, mas hoje √© um novo dia! üå§Ô∏è",
        "Opa, sumiu ontem! Tudo certo? Que tal registrar algo hoje? üòä",
        "Faz um dia que voc√™ n√£o vem... Mas relaxa, estamos aqui quando precisar! üíô",
        "Ontem voc√™ tirou uma folga, n√©? Sem problema! Bora retomar hoje? üöÄ",
        "T√° tudo bem n√£o aparecer todo dia. O importante √© voltar! E voc√™ voltou! üéâ",
        "Um dia de pausa... acontece! Que tal come√ßar de novo hoje? ‚ú®"
    ],
    
    // Mensagens quando h√° 2+ dias sem registro (acolhedoras, sem culpa)
    doisOuMaisDias: [
        "Oi! Faz uns dias que voc√™ sumiu... T√° tudo bem? A gente entende. Voltar j√° √© uma vit√≥ria! üí™",
        "Olha s√≥ quem voltou! ‚ù§Ô∏è N√£o importa quanto tempo passou, o que vale √© estar aqui agora.",
        "Ei, saudades de voc√™! Sem cobran√ßas, ok? Vamos juntos no seu ritmo ü§ó",
        "Que bom te ver de novo! Pausas fazem parte. O importante √© que voc√™ voltou! üåà",
        "Opa! Voc√™ t√° de volta e isso √© o que importa. Vamos recome√ßar juntos? üåü",
        "Bem-vindo de volta! A vida acontece, n√©? Mas voc√™ est√° aqui agora e isso √© incr√≠vel! üíô"
    ],
    
    // Mensagens quando j√° tem registro hoje (parabeniza√ß√£o leve)
    jaRegistrouHoje: [
        "Voc√™ j√° registrou algo hoje! Que orgulho! üéâ",
        "Opa, j√° cuidou de voc√™ hoje! Mandou bem! ‚≠ê",
        "J√° marcou presen√ßa hoje! Continue assim! üí™",
        "Voc√™ j√° est√° no caminho certo hoje! üöÄ",
        "Hoje voc√™ j√° apareceu! Isso √© dedica√ß√£o! üåü"
    ],
    
    // Mensagens quando h√° streak ativo (celebra√ß√£o)
    streakAtivo: [
        "üî• {dias} dias seguidos! Voc√™ est√° arrasando!",
        "üí™ {dias} dias de dedica√ß√£o! Incr√≠vel!",
        "üåü {dias} dias consecutivos! Que orgulho!",
        "üöÄ {dias} dias sem parar! Continue assim!",
        "‚≠ê {dias} dias direto! Voc√™ √© demais!"
    ]
};

/**
 * Verifica se h√° algum registro hoje em qualquer categoria
 */
function temRegistroHoje() {
    const hoje = formatDate(new Date());
    
    const temVacuum = vacuumData[hoje] && vacuumData[hoje].completed;
    const temWorkout = workoutData[hoje] && workoutData[hoje].completed;
    const temCare = careData[hoje] && careData[hoje].completed;
    
    return temVacuum || temWorkout || temCare;
}

/**
 * Calcula quantos dias se passaram desde a √∫ltima atividade
 */
function calcularDiasSemAtividade() {
    const hoje = new Date();
    hoje.setHours(0, 0, 0, 0);
    
    // Coletar todas as datas de atividade
    const todasDatas = new Set([
        ...Object.keys(vacuumData).filter(d => vacuumData[d].completed),
        ...Object.keys(workoutData).filter(d => workoutData[d].completed),
        ...Object.keys(careData).filter(d => careData[d].completed)
    ]);
    
    if (todasDatas.size === 0) {
        return -1; // Nunca registrou nada
    }
    
    // Encontrar a data mais recente
    const datasOrdenadas = Array.from(todasDatas).sort();
    const ultimaAtividade = parseLocalDate(
    datasOrdenadas[datasOrdenadas.length - 1]
);
    ultimaAtividade.setHours(0, 0, 0, 0);
    
    // Calcular diferen√ßa em dias
    const diferencaDias = Math.floor((hoje - ultimaAtividade) / (1000 * 60 * 60 * 24));
    
    return diferencaDias;
}

/**
 * Seleciona uma mensagem aleat√≥ria de um array
 */
function getRandomMessage(messagesArray) {
    return messagesArray[Math.floor(Math.random() * messagesArray.length)];
}

/**
 * Exibe mensagem motivacional baseada no contexto do usu√°rio
 */
function exibirMensagemMotivacional() {
    const diasSemAtividade = calcularDiasSemAtividade();
    const jaRegistrou = temRegistroHoje();
    const streak = streakData.streakAtual;
    
    let mensagem = '';
    let tipo = 'info';
    
    // L√ìGICA DE DECIS√ÉO DE QUAL MENSAGEM MOSTRAR
    
    // Caso 1: Nunca registrou nada ainda (primeira vez)
    if (diasSemAtividade === -1) {
        mensagem = "Bem-vindo! üëã Este √© seu espa√ßo de acompanhamento. Comece registrando suas atividades nas abas acima! üíô";
        tipo = 'info';
    }
    
    // Caso 2: J√° registrou algo hoje (parabenizar)
    else if (jaRegistrou) {
        if (streak >= 3) {
            // Se tem streak ativo, celebrar!
            mensagem = getRandomMessage(motivationalMessages.streakAtivo).replace('{dias}', streak);
            tipo = 'success';
        } else {
            mensagem = getRandomMessage(motivationalMessages.jaRegistrouHoje);
            tipo = 'success';
        }
    }
    
    // Caso 3: 2 ou mais dias sem atividade (acolher sem culpa)
    else if (diasSemAtividade >= 2) {
        mensagem = getRandomMessage(motivationalMessages.doisOuMaisDias);
        tipo = 'info';
    }
    
    // Caso 4: 1 dia sem atividade (incentivo leve)
    else if (diasSemAtividade === 1) {
        mensagem = getRandomMessage(motivationalMessages.umDiaSemAtividade);
        tipo = 'info';
    }
    
    // Caso 5: Ainda n√£o registrou hoje, mas registrou ontem (boas-vindas)
    else if (diasSemAtividade === 0) {
        mensagem = getRandomMessage(motivationalMessages.boasVindas);
        tipo = 'info';
    }
    
    // Exibir a mensagem
    if (mensagem) {
        showMessage(mensagem, tipo);
    }
}

/**
 * Controla se a mensagem j√° foi exibida na sess√£o atual
 * Evita mostrar mensagem repetida se o usu√°rio recarregar a p√°gina
 */
function deveMostrarMensagemDeBoasVindas() {
    const chave = 'mensagemExibidaHoje';
    const hoje = formatDate(new Date());
    const ultimaExibicao = sessionStorage.getItem(chave);
    
    // Se j√° exibiu hoje nesta sess√£o, n√£o mostrar novamente
    if (ultimaExibicao === hoje) {
        return false;
    }
    
    // Marcar como exibida
    sessionStorage.setItem(chave, hoje);
    return true;
}

/**
 * Fun√ß√£o principal que controla quando exibir mensagens
 */
function verificarEExibirMensagem() {
    // S√≥ exibe se ainda n√£o exibiu nesta sess√£o
    if (deveMostrarMensagemDeBoasVindas()) {
        // Aguardar 800ms para dar tempo da p√°gina carregar
        setTimeout(() => {
            exibirMensagemMotivacional();
        }, 800);
    }
}
        // ========================================
        // SISTEMA DE XP E GAMIFICA√á√ÉO
        // ========================================

        function addXP(category, amount, message) {
    xpData[category] += amount;
    
    // üîß CORRE√á√ÉO: XP Geral agora √© SOMA (n√£o m√©dia)
    // Tratamento de 2-4 anos requer progress√£o lenta e cont√≠nua
    xpData.xpGeral = xpData.xpTratamento + xpData.xpCorpo + xpData.xpCuidado;
    
    xpData.lastActivity = formatDate(new Date());
    saveUserData();
    updateXPDisplay();
    showMessage(message, 'success');
}

        function removeXP(category, percentage) {
    const amount = Math.floor(xpData[category] * (percentage / 100));
    xpData[category] = Math.max(0, xpData[category] - amount);
    
    // üîß CORRE√á√ÉO: Recalcular XP Geral como SOMA
    xpData.xpGeral = xpData.xpTratamento + xpData.xpCorpo + xpData.xpCuidado;
    
    
    saveUserData();
    updateXPDisplay();
}

        /**
 * Verifica inatividade e remove XP se necess√°rio
 * (Mensagens agora s√£o controladas por verificarEExibirMensagem)
 */
function checkInactivity() {
    const today = new Date();
    const lastActivity = parseLocalDate(xpData.lastActivity);
    const daysDiff = Math.floor((today - lastActivity) / (1000 * 60 * 60 * 24));

    // S√≥ penalizar se passou 3+ dias
    if (daysDiff >= 3) {
        const todayStr = formatDate(today);
        const yesterday = new Date(today);
        yesterday.setDate(yesterday.getDate() - 1);
        const yesterdayStr = formatDate(yesterday);
        const twoDaysAgo = new Date(today);
        twoDaysAgo.setDate(twoDaysAgo.getDate() - 2);
        const twoDaysAgoStr = formatDate(twoDaysAgo);

        // Verificar inatividade no Vacuum Bell
        if (!vacuumData[todayStr] && !vacuumData[yesterdayStr] && !vacuumData[twoDaysAgoStr]) {
            removeXP('xpTratamento', 5);
        }

        // Verificar inatividade na academia
        if (!workoutData[todayStr] && !workoutData[yesterdayStr] && !workoutData[twoDaysAgoStr]) {
            removeXP('xpCorpo', 5);
        }

        // Verificar inatividade no cuidado
        if (!careData[todayStr] && !careData[yesterdayStr] && !careData[twoDaysAgoStr]) {
            removeXP('xpCuidado', 5);
        }

        // Reduzir XP geral
        removeXP('xpGeral', 2);
        
        // Mensagem de inatividade n√£o √© mais necess√°ria aqui
        // Pois verificarEExibirMensagem() j√° cuida disso
    }
}
        function getCurrentRank() {
            let currentRank = ranks[0];
            for (let i = 0; i < ranks.length; i++) {
                if (xpData.xpGeral >= ranks[i].xp) {
                    currentRank = ranks[i];
                }
            }
            return currentRank;
        }

        function updateXPDisplay() {
            // Atualizar textos
            document.getElementById('xpTratamentoText').textContent = xpData.xpTratamento + ' XP';
            document.getElementById('xpCorpoText').textContent = xpData.xpCorpo + ' XP';
            document.getElementById('xpCuidadoText').textContent = xpData.xpCuidado + ' XP';
            document.getElementById('xpGeralText').textContent = xpData.xpGeral + ' XP';

            // Atualizar barras (m√°ximo de 1000 para visualiza√ß√£o)
            const maxXP = 1000;
            document.getElementById('xpTratamentoBar').style.width = 
                Math.min((xpData.xpTratamento / maxXP) * 100, 100) + '%';
            document.getElementById('xpCorpoBar').style.width = 
                Math.min((xpData.xpCorpo / maxXP) * 100, 100) + '%';
            document.getElementById('xpCuidadoBar').style.width = 
                Math.min((xpData.xpCuidado / maxXP) * 100, 100) + '%';
            document.getElementById('xpGeralBar').style.width = 
                Math.min((xpData.xpGeral / maxXP) * 100, 100) + '%';

            // Atualizar patente
            const currentRank = getCurrentRank();
            document.getElementById('rankBadge').textContent = currentRank.name;
        }

        function showMessage(message, type = 'info') {
            const container = document.getElementById('messageContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message-box message-${type}`;
            messageDiv.textContent = message;
            
            container.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 5000);
        }
        // ========================================
// FUN√á√ïES DE STREAK
// ========================================

function updateStreak() {
    const hoje = formatDate(new Date());
    
    if (streakData.ultimoDiaAtivo === hoje) {
        return;
    }
    
    if (!streakData.ultimoDiaAtivo) {
        streakData.streakAtual = 1;
        streakData.maiorStreak = 1;
        streakData.ultimoDiaAtivo = hoje;
        streakData.diasPausados = 0;
        saveStreakData();
        return;
    }
    
    const ultimaData = parseLocalDate(streakData.ultimoDiaAtivo);
const dataHoje = parseLocalDate(hoje);
    const diferencaDias = Math.floor((dataHoje - ultimaData) / (1000 * 60 * 60 * 24));
    
    if (diferencaDias === 1) {
        streakData.streakAtual++;
        streakData.diasPausados = 0;
        
        if (streakData.streakAtual > streakData.maiorStreak) {
            streakData.maiorStreak = streakData.streakAtual;
            showMessage(`üèÜ Novo recorde! ${streakData.maiorStreak} dias consecutivos!`, 'success');
        }
        
        if (streakData.streakAtual === 7 && !streakData.streak7Bonus) {
            addXP('xpGeral', 10, 'üî• +10 XP de B√îNUS por 7 dias consecutivos! Continue assim!');
            streakData.streak7Bonus = true;
        }
        
        if (streakData.streakAtual % 7 === 0 && streakData.streakAtual > 7) {
            addXP('xpGeral', 10, `üî• +10 XP! ${streakData.streakAtual} dias de dedica√ß√£o total!`);
        }
        
    } else if (diferencaDias > 1) {
        streakData.diasPausados = diferencaDias - 1;
        
        if (streakData.diasPausados >= 7) {
            streakData.streakAtual = 1;
            streakData.diasPausados = 0;
            streakData.streak7Bonus = false;
            showMessage(`Voc√™ pausou por ${diferencaDias} dias, mas est√° de volta! üí™ Vamos recome√ßar juntos.`, 'info');
        } else {
            streakData.streakAtual = 1;
            showMessage(`Voc√™ pausou por ${diferencaDias} dias. Tudo bem! Estamos recome√ßando. üòä`, 'info');
        }
    }
    
    streakData.ultimoDiaAtivo = hoje;
    saveStreakData();
    updateStreakDisplay();
}

function saveStreakData() {
    
    saveUserData();
}

function updateStreakDisplay() {
    const streakAtualEl = document.getElementById('streakAtualValue');
    const maiorStreakEl = document.getElementById('maiorStreakValue');
    
    if (streakAtualEl) {
        streakAtualEl.textContent = streakData.streakAtual;
    }
    
    if (maiorStreakEl) {
        maiorStreakEl.textContent = streakData.maiorStreak;
    }
}

function recalcularStreak() {
    const todasDatas = new Set([
        ...Object.keys(vacuumData).filter(d => vacuumData[d].completed),
        ...Object.keys(workoutData).filter(d => workoutData[d].completed),
        ...Object.keys(careData).filter(d => careData[d].completed)
    ]);
    
    const datasOrdenadas = Array.from(todasDatas).sort();
    
    if (datasOrdenadas.length === 0) {
        streakData.streakAtual = 0;
        streakData.maiorStreak = 0;
        streakData.ultimoDiaAtivo = null;
        saveStreakData();
        return;
    }
    
    let streakAtual = 1;
    let maiorStreak = 1;
    
    for (let i = 1; i < datasOrdenadas.length; i++) {
        const dataAnterior = parseLocalDate(datasOrdenadas[i - 1]);
const dataAtual = parseLocalDate(datasOrdenadas[i]);
        const diferencaDias = Math.floor((dataAtual - dataAnterior) / (1000 * 60 * 60 * 24));
        
        if (diferencaDias === 1) {
            streakAtual++;
            maiorStreak = Math.max(maiorStreak, streakAtual);
        } else {
            streakAtual = 1;
        }
    }
    
    const ultimaData = parseLocalDate(
    datasOrdenadas[datasOrdenadas.length - 1]
);

    const hoje = new Date();
    const diferencaDias = Math.floor((hoje - ultimaData) / (1000 * 60 * 60 * 24));
    
    if (diferencaDias > 1) {
        streakAtual = 0;
    }
    
    streakData.streakAtual = streakAtual;
    streakData.maiorStreak = Math.max(maiorStreak, streakData.maiorStreak);
    streakData.ultimoDiaAtivo = datasOrdenadas[datasOrdenadas.length - 1];
    
    saveStreakData();
    updateStreakDisplay();
}
        // ========================================
        // VACUUM BELL
        // ========================================

        function updateVacuumTime() {
            const week = parseInt(document.getElementById('vacuumWeek').value);
            const maxTime = parseInt(document.getElementById('vacuumMaxTime').value);
            let time = week * 5;
            
            if (time > maxTime) {
                time = maxTime;
            }
            
            settings.vacuumWeek = week;
            settings.vacuumMaxTime = maxTime;
            
            saveUserData();
            
            document.getElementById('currentTime').textContent = time;
            updateDashboard();
        }

        function addPreviousDays() {
            const days = parseInt(document.getElementById('previousDays').value) || 0;
            if (days > 0) {
                settings.previousDaysAdded = days;
                
                saveUserData();
                showMessage(`${days} dias anteriores adicionados com sucesso!`, 'success');
                updateDashboard();
            }
        }

        function checkInVacuum() {
            const today = formatDate(new Date());
            
            if (vacuumData[today] && vacuumData[today].completed) {
                showMessage('Voc√™ j√° registrou o Vacuum Bell hoje!', 'info');
                return;
            }

            const notes = document.getElementById('vacuumNotes').value;
            const noPain = document.getElementById('noPainCheckbox').checked;
            const week = settings.vacuumWeek;
            const maxTime = settings.vacuumMaxTime;
            let time = week * 5;
            if (time > maxTime) time = maxTime;
            
            vacuumData[today] = {
                completed: true,
                notes: notes,
                time: time,
                week: week,
                noPain: noPain
            };
            
        
            saveUserData();
            
            // ADICIONAR XP
            let xpGained = 10;
            let message = '‚úÖ +10 XP por usar o Vacuum Bell!';
            
            if (noPain) {
                xpGained += 5;
                message = '‚úÖ +15 XP! Uso consciente sem dor. Voc√™ est√° arrasando! üéâ';
            }
            
            addXP('xpTratamento', xpGained, message);
            updateStreak();
            
            document.getElementById('vacuumNotes').value = '';
            document.getElementById('noPainCheckbox').checked = false;
            
            renderVacuumCalendar();
            updateDashboard();
            loadVacuumHistory();
            updateAllCharts();
        }

        function renderVacuumCalendar() {
            const calendar = document.getElementById('vacuumCalendar');
            calendar.innerHTML = '';
            
            const year = currentVacuumMonth.getFullYear();
            const month = currentVacuumMonth.getMonth();
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            const dayNames = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b'];
            dayNames.forEach(name => {
                const header = document.createElement('div');
                header.className = 'calendar-header';
                header.textContent = name;
                calendar.appendChild(header);
            });
            
            for (let i = 0; i < firstDay; i++) {
                calendar.appendChild(document.createElement('div'));
            }
            
            const today = formatDate(new Date());
            
            for (let day = 1; day <= daysInMonth; day++) {
                const date = formatDate(new Date(year, month, day));
                const dayEl = document.createElement('div');
                dayEl.className = 'calendar-day';
                
                const dayNum = document.createElement('div');
                dayNum.textContent = day;
                dayEl.appendChild(dayNum);
                
                const icons = document.createElement('div');
                icons.className = 'calendar-icons';
                
                if (vacuumData[date] && vacuumData[date].completed) {
                    dayEl.classList.add('completed');
                    icons.textContent = 'ü´Å';
                    
                    // Adicionar XP do dia
                    const xpDiv = document.createElement('div');
                    xpDiv.className = 'calendar-xp';
                    let xpGained = 10;
                    if (vacuumData[date].noPain) xpGained += 5;
                    xpDiv.textContent = `+${xpGained}`;
                    dayEl.appendChild(xpDiv);
                }
                
                if (date === today) {
                    dayEl.classList.add('today');
                }
                
                dayEl.appendChild(icons);
                calendar.appendChild(dayEl);
            }
            
            document.getElementById('vacuumMonthLabel').textContent = getMonthName(currentVacuumMonth);
        }

        function changeVacuumMonth(direction) {
            currentVacuumMonth.setMonth(currentVacuumMonth.getMonth() + direction);
            renderVacuumCalendar();
        }

        function loadVacuumHistory() {
            const history = document.getElementById('vacuumHistory');
            history.innerHTML = '';
            
            const entries = Object.entries(vacuumData)
                .sort((a, b) => parseLocalDate(b[0]) - parseLocalDate(a[0]))
                .slice(0, 10);
            
            if (entries.length === 0) {
                history.innerHTML = '<p style="color: #666;">Nenhum registro ainda.</p>';
                return;
            }
            
            entries.forEach(([date, data]) => {
                const item = document.createElement('div');
                item.className = 'history-item';
                item.innerHTML = `
                    <div class="history-date">${parseLocalDate(date).toLocaleDateString('pt-BR')}</div>
                    <div class="history-details">
                        <strong>Tempo:</strong> ${data.time} minutos | 
                        <strong>Semana:</strong> ${data.week}
                        ${data.noPain ? ' | ‚úÖ Sem dor' : ''}<br>
                        ${data.notes ? `<strong>Obs:</strong> ${data.notes}` : ''}
                    </div>
                `;
                history.appendChild(item);
            });
        }

        // ========================================
        // TREINO / ACADEMIA
        // ========================================

        function checkInWorkout() {
            const today = formatDate(new Date());
            
            if (workoutData[today] && workoutData[today].completed) {
                showMessage('Voc√™ j√° registrou treino hoje!', 'info');
                return;
            }

            const type = document.getElementById('workoutType').value;
            const notes = document.getElementById('workoutNotes').value;
            
            if (!type) {
                showMessage('Por favor, selecione o treino do dia!', 'warning');
                return;
            }
            
            workoutData[today] = {
                completed: true,
                type: type,
                notes: notes
            };
            
        
            saveUserData();
            
            // ADICIONAR XP
            let xpGained = 10;
            let message = 'üí™ +10 XP por treinar hoje!';
            
            if (notes && notes.length > 10) {
                xpGained += 5;
                message = 'üí™ +15 XP! Treino com observa√ß√µes detalhadas. Muito bem!';
            }
            
            addXP('xpCorpo', xpGained, message);
            updateStreak();
            
            document.getElementById('workoutType').value = '';
            document.getElementById('workoutNotes').value = '';
            
            renderWorkoutCalendar();
            updateDashboard();
            loadWorkoutHistory();
        }

        function renderWorkoutCalendar() {
            const calendar = document.getElementById('workoutCalendar');
            calendar.innerHTML = '';
            
            const year = currentWorkoutMonth.getFullYear();
            const month = currentWorkoutMonth.getMonth();
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            const dayNames = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b'];
            dayNames.forEach(name => {
                const header = document.createElement('div');
                header.className = 'calendar-header';
                header.textContent = name;
                calendar.appendChild(header);
            });
            
            for (let i = 0; i < firstDay; i++) {
                calendar.appendChild(document.createElement('div'));
            }
            
            const today = formatDate(new Date());
            
            for (let day = 1; day <= daysInMonth; day++) {
                const date = formatDate(new Date(year, month, day));
                const dayEl = document.createElement('div');
                dayEl.className = 'calendar-day';
                
                const dayNum = document.createElement('div');
                dayNum.textContent = day;
                dayEl.appendChild(dayNum);
                
                const icons = document.createElement('div');
                icons.className = 'calendar-icons';
                
                if (workoutData[date] && workoutData[date].completed) {
                    dayEl.classList.add('completed');
                    icons.textContent = 'üí™';
                    
                    // Adicionar XP do dia
                    const xpDiv = document.createElement('div');
                    xpDiv.className = 'calendar-xp';
                    let xpGained = 10;
                    if (workoutData[date].notes && workoutData[date].notes.length > 10) xpGained += 5;
                    xpDiv.textContent = `+${xpGained}`;
                    dayEl.appendChild(xpDiv);
                }
                
                if (date === today) {
                    dayEl.classList.add('today');
                }
                
                dayEl.appendChild(icons);
                calendar.appendChild(dayEl);
            }
            
            document.getElementById('workoutMonthLabel').textContent = getMonthName(currentWorkoutMonth);
        }

        function changeWorkoutMonth(direction) {
            currentWorkoutMonth.setMonth(currentWorkoutMonth.getMonth() + direction);
            renderWorkoutCalendar();
        }

        function loadWorkoutHistory() {
            const history = document.getElementById('workoutHistory');
            history.innerHTML = '';
            
            const entries = Object.entries(workoutData)
                .sort((a, b) => parseLocalDate(b[0]) - parseLocalDate(a[0]))
                .slice(0, 10);
            
            if (entries.length === 0) {
                history.innerHTML = '<p style="color: #666;">Nenhum treino registrado ainda.</p>';
                return;
            }
            
            entries.forEach(([date, data]) => {
                const item = document.createElement('div');
                item.className = 'history-item';
                item.innerHTML = `
                    <div class="history-date">${parseLocalDate(date).toLocaleDateString('pt-BR')}</div>
                    <div class="history-details">
                        <strong>Treino:</strong> ${data.type}<br>
                        ${data.notes ? `<strong>Obs:</strong> ${data.notes}` : ''}
                    </div>
                `;
                history.appendChild(item);
            });
        }

        // ========================================
        // CUIDADO DI√ÅRIO
        // ========================================

        function toggleCareCheckbox() {
            const checkbox = document.getElementById('careCheckbox');
            checkbox.checked = !checkbox.checked;
        }

        function checkInCare() {
            const today = formatDate(new Date());
            
            if (careData[today] && careData[today].completed) {
                showMessage('Voc√™ j√° registrou o cuidado de hoje!', 'info');
                return;
            }

            const checked = document.getElementById('careCheckbox').checked;
            
            if (!checked) {
                showMessage('Marque o checkbox para registrar o cuidado!', 'warning');
                return;
            }
            
            const food = document.getElementById('careFood').value;
            const selfCare = document.getElementById('careSelfCare').value;
            
            careData[today] = {
                completed: true,
                food: food,
                selfCare: selfCare
            };
            
         
            saveUserData();
            
            // ADICIONAR XP
            addXP('xpCuidado', 5, 'üçΩÔ∏è +5 XP por cuidar de voc√™ hoje!');
            updateStreak();
            document.getElementById('careCheckbox').checked = false;
            document.getElementById('careFood').value = '';
            document.getElementById('careSelfCare').value = '';
            renderCareCalendar();
            loadCareHistory();
        }

        function renderCareCalendar() {
            const calendar = document.getElementById('careCalendar');
            calendar.innerHTML = '';
            
            const year = currentCareMonth.getFullYear();
            const month = currentCareMonth.getMonth();
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            const dayNames = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b'];
            dayNames.forEach(name => {
                const header = document.createElement('div');
                header.className = 'calendar-header';
                header.textContent = name;
                calendar.appendChild(header);
            });
            
            for (let i = 0; i < firstDay; i++) {
                calendar.appendChild(document.createElement('div'));
            }
            
            const today = formatDate(new Date());
            
            for (let day = 1; day <= daysInMonth; day++) {
                const date = formatDate(new Date(year, month, day));
                const dayEl = document.createElement('div');
                dayEl.className = 'calendar-day';
                
                const dayNum = document.createElement('div');
                dayNum.textContent = day;
                dayEl.appendChild(dayNum);
                
                const icons = document.createElement('div');
                icons.className = 'calendar-icons';
                
                if (careData[date] && careData[date].completed) {
                    dayEl.classList.add('completed');
                    icons.textContent = 'üçΩÔ∏è';
                    
                    // Adicionar XP do dia
                    const xpDiv = document.createElement('div');
                    xpDiv.className = 'calendar-xp';
                    xpDiv.textContent = '+5';
                    dayEl.appendChild(xpDiv);
                }
                
                if (date === today) {
                    dayEl.classList.add('today');
                }
                
                dayEl.appendChild(icons);
                calendar.appendChild(dayEl);
            }
            
            document.getElementById('careMonthLabel').textContent = getMonthName(currentCareMonth);
        }

        function changeCareMonth(direction) {
            currentCareMonth.setMonth(currentCareMonth.getMonth() + direction);
            renderCareCalendar();
        }

        function loadCareHistory() {
            const history = document.getElementById('careHistory');
            history.innerHTML = '';
            
            const entries = Object.entries(careData)
                .sort((a, b) => parseLocalDate(b[0]) - parseLocalDate(a[0]))
                .slice(0, 10);
            
            if (entries.length === 0) {
                history.innerHTML = '<p style="color: #666;">Nenhum cuidado registrado ainda.</p>';
                return;
            }
            
            entries.forEach(([date, data]) => {
                const item = document.createElement('div');
                item.className = 'history-item';
                
                let details = '‚úÖ Cuidado di√°rio registrado';
                if (data.food) details += `<br><strong>üçΩÔ∏è Alimenta√ß√£o:</strong> ${data.food}`;
                if (data.selfCare) details += `<br><strong>ü´Å Autocuidado:</strong> ${data.selfCare}`;
                
                item.innerHTML = `
                    <div class="history-date">${parseLocalDate(date).toLocaleDateString('pt-BR')}</div>
                    <div class="history-details">${details}</div>
                `;
                history.appendChild(item);
            });
        }

        // ========================================
        // PESO
        // ========================================

        function saveWeight() {
            const weight = parseFloat(document.getElementById('weightInput').value);
            if (!weight || weight <= 0) {
                showMessage('Por favor, insira um peso v√°lido!', 'warning');
                return;
            }
            
            const today = new Date();
            const monthYear = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}`;
            
            weightData.push({
                date: formatDate(today),
                monthYear: monthYear,
                weight: weight
            });
            
        
            saveUserData();
            document.getElementById('weightInput').value = '';
            showMessage('‚úÖ Peso registrado com sucesso!', 'success');
            loadWeightHistory();
            updateDashboard();
            updateAllCharts();
        }

        function loadWeightHistory() {
            const history = document.getElementById('weightHistory');
            history.innerHTML = '';
            
            if (weightData.length === 0) {
                history.innerHTML = '<p style="color: #666;">Nenhum peso registrado ainda.</p>';
                return;
            }
            
           const sortedData = [...weightData].sort((a, b) => parseLocalDate(b.date) - parseLocalDate(a.date));
            
            sortedData.forEach((entry, index) => {
                const item = document.createElement('div');
                item.className = 'history-item';
                
                let variation = '';
                if (index < sortedData.length - 1) {
                    const diff = entry.weight - sortedData[index + 1].weight;
                    const sign = diff > 0 ? '+' : '';
                    const color = diff > 0 ? 'red' : 'green';
                    variation = `<span style="color: ${color}; font-weight: bold;"> (${sign}${diff.toFixed(1)} kg)</span>`;
                }
                
                item.innerHTML = `
                    <div class="history-date">${parseLocalDate(entry.date).toLocaleDateString('pt-BR')}</div>
                    <div class="history-details">
                        <strong>Peso:</strong> ${entry.weight.toFixed(1)} kg ${variation}
                    </div>
                `;
                history.appendChild(item);
            });
        }

        // ========================================
        // MEDI√á√ÉO PECTUS
        // ========================================

        function saveMeasurement() {
            const depth = parseFloat(document.getElementById('pectusDepth').value);
            const notes = document.getElementById('pectusNotes').value;
            
            if (!depth || depth <= 0) {
                showMessage('Por favor, insira uma medida v√°lida!', 'warning');
                return;
            }
            
            const today = new Date();
            const monthYear = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}`;
            
            measurementData.push({
                date: formatDate(today),
                monthYear: monthYear,
                depth: depth,
                notes: notes
            });
            
           
            saveUserData();
            document.getElementById('pectusDepth').value = '';
            document.getElementById('pectusNotes').value = '';
            showMessage('‚úÖ Medi√ß√£o registrada com sucesso!', 'success');
            loadMeasurementHistory();
            updateAllCharts();
        }

        function loadMeasurementHistory() {
            const history = document.getElementById('measurementHistory');
            history.innerHTML = '';
            
            if (measurementData.length === 0) {
                history.innerHTML = '<p style="color: #666;">Nenhuma medi√ß√£o registrada ainda.</p>';
                return;
            }
            
            const sortedData = [...measurementData].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedData.forEach((entry, index) => {
                const item = document.createElement('div');
                item.className = 'history-item';
                
                let variation = '';
                if (index < sortedData.length - 1) {
                    const diff = entry.depth - sortedData[index + 1].depth;
                    const sign = diff > 0 ? '+' : '';
                    const color = diff < 0 ? 'green' : 'red';
                    variation = `<span style="color: ${color}; font-weight: bold;"> (${sign}${diff.toFixed(1)} cm)</span>`;
                }
                
                item.innerHTML = `
                    <div class="history-date">${parseLocalDate(entry.date).toLocaleDateString('pt-BR')}</div>
                    <div class="history-details">
                        <strong>Profundidade:</strong> ${entry.depth.toFixed(1)} cm ${variation}<br>
                        ${entry.notes ? `<strong>Obs:</strong> ${entry.notes}` : ''}
                    </div>
                `;
                history.appendChild(item);
            });
        }

        // ========================================
        // FOTOS
        // ========================================

        function addPhoto() {
            const input = document.getElementById('photoInput');
            const file = input.files[0];
            
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const today = new Date();
                const monthYear = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}`;
                
                photoData.push({
                    date: formatDate(today),
                    monthYear: monthYear,
                    image: e.target.result
                });
                
             
                saveUserData();
                loadPhotoGallery();
                showMessage('‚úÖ Foto adicionada com sucesso!', 'success');
            };
            reader.readAsDataURL(file);
            input.value = '';
        }

        function loadPhotoGallery() {
    const gallery = document.getElementById('photoGallery');
    gallery.innerHTML = '';
    
    const year = currentPhotoMonth.getFullYear();
    const month = String(currentPhotoMonth.getMonth() + 1).padStart(2, '0');
    const monthYear = `${year}-${month}`;
    
    const filteredPhotos = photoData.filter(photo => photo.monthYear === monthYear);
    
    if (filteredPhotos.length === 0) {
        gallery.innerHTML = '<p style="color: #666; grid-column: 1/-1; text-align: center;">Nenhuma foto neste m√™s.</p>';
        return;
    }
    
    filteredPhotos.forEach((photo, index) => {
        const item = document.createElement('div');
        item.className = 'image-item';
        item.innerHTML = `
            <img src="${photo.image}" alt="Progresso">
            <button class="delete-btn" onclick="deletePhoto(${photoData.indexOf(photo)})">√ó</button>
            <div class="image-date">${parseLocalDate(photo.date).toLocaleDateString('pt-BR')}</div>
        `;
        gallery.appendChild(item);
    });
    
    document.getElementById('photoMonthLabel').textContent = getMonthName(currentPhotoMonth);
}

        function deletePhoto(index) {
            if (confirm('Tem certeza que deseja excluir esta foto?')) {
                photoData.splice(index, 1);
              
                saveUserData();
                loadPhotoGallery();
                showMessage('Foto exclu√≠da!', 'info');
            }
        }

        function changePhotoMonth(direction) {
            currentPhotoMonth.setMonth(currentPhotoMonth.getMonth() + direction);
            loadPhotoGallery();
        }

        // ========================================
        // RELAT√ìRIO MENSAL
        // ========================================

        function generateMonthlyReport() {
            const year = currentReportMonth.getFullYear();
            const month = currentReportMonth.getMonth();
            const monthYear = `${year}-${String(month + 1).padStart(2, '0')}`;
            
            document.getElementById('reportMonthLabel').textContent = getMonthName(currentReportMonth);
            
            // Filtrar dados do m√™s
            const vacuumDays = Object.keys(vacuumData).filter(date => date.startsWith(monthYear));
            const workoutDays = Object.keys(workoutData).filter(date => date.startsWith(monthYear));
            const careDays = Object.keys(careData).filter(date => date.startsWith(monthYear));
            
            // Calcular streak (sequ√™ncia)
            const allDates = [...new Set([...vacuumDays, ...workoutDays, ...careDays])].sort();
            let maxStreak = 0;
            let currentStreak = 0;
            
            for (let i = 0; i < allDates.length; i++) {
                if (i === 0) {
                    currentStreak = 1;
                } else {
                    const prevDate = new Date(allDates[i - 1]);
                    const currDate = new Date(allDates[i]);
                    const diffDays = Math.floor((currDate - prevDate) / (1000 * 60 * 60 * 24));
                    
                    if (diffDays === 1) {
                        currentStreak++;
                    } else {
                        currentStreak = 1;
                    }
                }
                maxStreak = Math.max(maxStreak, currentStreak);
            }
            
            // Calcular XP ganho no m√™s
            const xpGanhoMes = (vacuumDays.length * 10) + (workoutDays.length * 10) + (careDays.length * 5);
            
            // Peso
            const monthWeights = weightData.filter(w => w.monthYear === monthYear);
            const pesoInfo = monthWeights.length > 0 
                ? `${monthWeights[monthWeights.length - 1].weight.toFixed(1)} kg` 
                : 'N√£o registrado';
            
            // Medi√ß√£o
            const monthMeasurements = measurementData.filter(m => m.monthYear === monthYear);
            const medicaoInfo = monthMeasurements.length > 0 
                ? `${monthMeasurements[monthMeasurements.length - 1].depth.toFixed(1)} cm` 
                : 'N√£o registrado';
            
            // Mensagens motivacionais
            const motivationalMessages = [
                "Voc√™ apareceu. Isso j√° conta muito. Continue assim! üí™",
                "Cada dia √© uma vit√≥ria. Voc√™ est√° no caminho certo! üéØ",
                "O progresso n√£o √© sobre perfei√ß√£o, √© sobre persist√™ncia. üåü",
                "Voc√™ est√° cuidando de voc√™. Isso √© o que importa! üíô",
                "Pequenos passos, grandes resultados. Continue firme! üöÄ",
                "Sua dedica√ß√£o est√° fazendo a diferen√ßa! ‚≠ê",
                "Voc√™ n√£o est√° s√≥ nessa jornada. Continue avan√ßando! ü§ù"
            ];
            
            const randomMessage = motivationalMessages[Math.floor(Math.random() * motivationalMessages.length)];
            
            // Renderizar relat√≥rio
            const reportContent = document.getElementById('reportContent');
            reportContent.innerHTML = `
                <div class="report-section">
                    <h3>üìä Resumo do M√™s</h3>
                    <div class="report-stats">
                        <div class="report-stat">
                            <div class="report-stat-value">${allDates.length}</div>
                            <div class="report-stat-label">Dias Ativos</div>
                        </div>
                        <div class="report-stat">
                            <div class="report-stat-value">${maxStreak}</div>
                            <div class="report-stat-label">Maior Sequ√™ncia</div>
                        </div>
                        <div class="report-stat">
                            <div class="report-stat-value">${xpGanhoMes}</div>
                            <div class="report-stat-label">XP Ganho</div>
                        </div>
                        <div class="report-stat">
                            <div class="report-stat-value">${getCurrentRank().name}</div>
                            <div class="report-stat-label">Patente Atual</div>
                        </div>
                    </div>
                </div>

                <div class="report-section">
                    <h3>ü´Å Vacuum Bell</h3>
                    <div class="report-stats">
                        <div class="report-stat">
                            <div class="report-stat-value">${vacuumDays.length}</div>
                            <div class="report-stat-label">Dias de Uso</div>
                        </div>
                        <div class="report-stat">
                            <div class="report-stat-value">${((vacuumDays.length / new Date(year, month + 1, 0).getDate()) * 100).toFixed(0)}%</div>
                            <div class="report-stat-label">Taxa de Uso</div>
                        </div>
                    </div>
                </div>

                <div class="report-section">
                    <h3>üí™ Academia</h3>
                    <div class="report-stats">
                        <div class="report-stat">
                            <div class="report-stat-value">${workoutDays.length}</div>
                            <div class="report-stat-label">Dias de Treino</div>
                        </div>
                        <div class="report-stat">
                            <div class="report-stat-value">${((workoutDays.length / new Date(year, month + 1, 0).getDate()) * 100).toFixed(0)}%</div>
                            <div class="report-stat-label">Taxa de Treino</div>
                        </div>
                    </div>
                </div>

                <div class="report-section">
                    <h3>üçΩÔ∏è Cuidado Di√°rio</h3>
                    <div class="report-stats">
                        <div class="report-stat">
                            <div class="report-stat-value">${careDays.length}</div>
                            <div class="report-stat-label">Dias de Cuidado</div>
                        </div>
                    </div>
                </div>

                <div class="report-section">
                    <h3>üìè Medi√ß√µes</h3>
                    <div class="report-stats">
                        <div class="report-stat">
                            <div class="report-stat-value">${pesoInfo}</div>
                            <div class="report-stat-label">Peso</div>
                        </div>
                        <div class="report-stat">
                            <div class="report-stat-value">${medicaoInfo}</div>
                            <div class="report-stat-label">Pectus</div>
                        </div>
                    </div>
                </div>

                <div class="report-section">
                    <h3>üìÖ Calend√°rio do M√™s</h3>
                    <div class="mini-calendar" id="miniCalendar"></div>
                </div>

                <div class="report-section">
                    <h3>üí¨ Mensagem Final</h3>
                    <div class="info-box" style="margin: 0;">
                        <strong>${randomMessage}</strong>
                    </div>
                </div>
            `;
            
            // Renderizar mini calend√°rio
            renderMiniCalendar(year, month, allDates);
        }

        function renderMiniCalendar(year, month, activeDates) {
            const calendar = document.getElementById('miniCalendar');
            if (!calendar) return;
            
            calendar.innerHTML = '';
            
            const dayNames = ['D', 'S', 'T', 'Q', 'Q', 'S', 'S'];
            dayNames.forEach(name => {
                const header = document.createElement('div');
                header.style.fontWeight = 'bold';
                header.style.color = '#667eea';
                header.style.textAlign = 'center';
                header.style.padding = '5px';
                header.textContent = name;
                calendar.appendChild(header);
            });
            
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            for (let i = 0; i < firstDay; i++) {
                calendar.appendChild(document.createElement('div'));
            }
            
            for (let day = 1; day <= daysInMonth; day++) {
                const date = formatDate(new Date(year, month, day));
                const dayEl = document.createElement('div');
                dayEl.className = 'mini-calendar-day';
                
                // N√∫mero do dia
                const dayNum = document.createElement('div');
                dayNum.textContent = day;
                dayNum.style.fontWeight = '700';
                dayEl.appendChild(dayNum);
                
                // √çcones das atividades
                const iconsDiv = document.createElement('div');
                iconsDiv.style.fontSize = '0.6em';
                iconsDiv.style.display = 'flex';
                iconsDiv.style.gap = '2px';
                iconsDiv.style.marginTop = '2px';
                
                let totalXP = 0;
                
                if (vacuumData[date] && vacuumData[date].completed) {
                    iconsDiv.textContent += 'ü´Å';
                    totalXP += vacuumData[date].noPain ? 15 : 10;
                }
                if (workoutData[date] && workoutData[date].completed) {
                    iconsDiv.textContent += 'üí™';
                    totalXP += (workoutData[date].notes && workoutData[date].notes.length > 10) ? 15 : 10;
                }
                if (careData[date] && careData[date].completed) {
                    iconsDiv.textContent += 'üçΩÔ∏è';
                    totalXP += 5;
                }
                
                if (iconsDiv.textContent) {
                    dayEl.appendChild(iconsDiv);
                    
                    // Mostrar XP total
                    const xpDiv = document.createElement('div');
                    xpDiv.style.fontSize = '0.55em';
                    xpDiv.style.color = '#7C3AED';
                    xpDiv.style.fontWeight = '700';
                    xpDiv.style.marginTop = '1px';
                    xpDiv.textContent = `+${totalXP}`;
                    dayEl.appendChild(xpDiv);
                    
                    dayEl.classList.add('active');
                }
                
                calendar.appendChild(dayEl);
            }
        }

        function changeReportMonth(direction) {
            currentReportMonth.setMonth(currentReportMonth.getMonth() + direction);
            generateMonthlyReport();
        }

        // ========================================
        // DASHBOARD
        // ========================================

        function updateDashboard() {
            // Total de dias Vacuum Bell
            const totalVacuum = Object.keys(vacuumData).length + settings.previousDaysAdded;
            document.getElementById('totalVacuumDays').textContent = totalVacuum;
            
            // Tempo atual baseado na semana
            const week = settings.vacuumWeek;
            const maxTime = settings.vacuumMaxTime;
            let time = week * 5;
            if (time > maxTime) time = maxTime;
            document.getElementById('currentTime').textContent = time;
            
            // Total de dias de treino
            const totalWorkout = Object.keys(workoutData).length;
            document.getElementById('totalWorkoutDays').textContent = totalWorkout;
            
            // Peso atual
            if (weightData.length > 0) {
                const latest = weightData.sort((a, b) => new Date(b.date) - new Date(a.date))[0];
                document.getElementById('currentWeight').textContent = latest.weight.toFixed(1);
            }
        }
        // ========================================
// SISTEMA DE GR√ÅFICOS - NOVO
// ========================================

// Vari√°veis globais para armazenar inst√¢ncias dos gr√°ficos
let chartPeso = null;
let chartPectus = null;
let chartVacuum = null;

/**
 * Configura√ß√£o padr√£o de cores e estilos dos gr√°ficos
 */
const chartColors = {
    primary: 'rgba(102, 126, 234, 1)',      // #667eea
    primaryLight: 'rgba(102, 126, 234, 0.2)',
    secondary: 'rgba(118, 75, 162, 1)',     // #764ba2
    success: 'rgba(76, 175, 80, 1)',        // #4caf50
    successLight: 'rgba(76, 175, 80, 0.2)',
    grid: 'rgba(0, 0, 0, 0.05)'
};

/**
 * Configura√ß√£o comum para todos os gr√°ficos
 */
const commonChartOptions = {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
        legend: {
            display: false
        },
        tooltip: {
            backgroundColor: 'rgba(0, 0, 0, 0.8)',
            padding: 12,
            titleFont: {
                size: 14,
                weight: 'bold'
            },
            bodyFont: {
                size: 13
            },
            cornerRadius: 8
        }
    },
    scales: {
        x: {
            grid: {
                color: chartColors.grid,
                drawBorder: false
            },
            ticks: {
                font: {
                    size: 11
                }
            }
        },
        y: {
            grid: {
                color: chartColors.grid,
                drawBorder: false
            },
            ticks: {
                font: {
                    size: 11
                }
            }
        }
    }
};

/**
 * Renderiza o gr√°fico de evolu√ß√£o do peso
 */
function renderChartPeso() {
    const canvas = document.getElementById('chartPeso');
    if (!canvas) return;

    const ctx = canvas.getContext('2d');

    // Destruir gr√°fico anterior se existir
    if (chartPeso) {
        chartPeso.destroy();
    }

    // Verificar se h√° dados
    if (weightData.length === 0) {
        canvas.style.display = 'none';
        const wrapper = canvas.parentElement;
        wrapper.innerHTML = `
            <div class="chart-empty-state">
                <p style="font-size: 3em;">‚öñÔ∏è</p>
                <p><strong>Nenhum peso registrado ainda</strong></p>
                <p style="font-size: 0.9em;">Comece a registrar seu peso para ver a evolu√ß√£o aqui</p>
            </div>
        `;
        return;
    }

    canvas.style.display = 'block';

    // Ordenar dados por data
    const sortedData = [...weightData].sort((a, b) => parseLocalDate(a.date) - parseLocalDate(b.date));

    // Preparar dados para o gr√°fico
    const labels = sortedData.map(entry => {
        const date = parseLocalDate(entry.date);
        return date.toLocaleDateString('pt-BR', { day: '2-digit', month: 'short' });
    });

    const data = sortedData.map(entry => entry.weight);

    // Criar gr√°fico
    chartPeso = new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'Peso (kg)',
                data: data,
                borderColor: chartColors.primary,
                backgroundColor: chartColors.primaryLight,
                borderWidth: 3,
                fill: true,
                tension: 0.4,
                pointRadius: 5,
                pointHoverRadius: 7,
                pointBackgroundColor: chartColors.primary,
                pointBorderColor: '#fff',
                pointBorderWidth: 2
            }]
        },
        options: {
            ...commonChartOptions,
            plugins: {
                ...commonChartOptions.plugins,
                tooltip: {
                    ...commonChartOptions.plugins.tooltip,
                    callbacks: {
                        label: function(context) {
                            return `Peso: ${context.parsed.y.toFixed(1)} kg`;
                        }
                    }
                }
            },
            scales: {
                ...commonChartOptions.scales,
                y: {
                    ...commonChartOptions.scales.y,
                    ticks: {
                        ...commonChartOptions.scales.y.ticks,
                        callback: function(value) {
                            return value.toFixed(1) + ' kg';
                        }
                    }
                }
            }
        }
    });
}

/**
 * Renderiza o gr√°fico de evolu√ß√£o da profundidade do pectus
 */
function renderChartPectus() {
    const canvas = document.getElementById('chartPectus');
    if (!canvas) return;

    const ctx = canvas.getContext('2d');

    // Destruir gr√°fico anterior se existir
    if (chartPectus) {
        chartPectus.destroy();
    }

    // Verificar se h√° dados
    if (measurementData.length === 0) {
        canvas.style.display = 'none';
        const wrapper = canvas.parentElement;
        wrapper.innerHTML = `
            <div class="chart-empty-state">
                <p style="font-size: 3em;">üìè</p>
                <p><strong>Nenhuma medi√ß√£o registrada ainda</strong></p>
                <p style="font-size: 0.9em;">Registre medi√ß√µes para acompanhar a evolu√ß√£o do pectus</p>
            </div>
        `;
        return;
    }

    canvas.style.display = 'block';

    // Ordenar dados por data
    const sortedData = [...measurementData].sort((a, b) => new Date(a.date) - new Date(b.date));

    // Preparar dados para o gr√°fico
    const labels = sortedData.map(entry => {
        const date = parseLocalDate(entry.date);
        return date.toLocaleDateString('pt-BR', { day: '2-digit', month: 'short' });
    });

    const data = sortedData.map(entry => entry.depth);

    // Criar gr√°fico
    chartPectus = new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'Profundidade (cm)',
                data: data,
                borderColor: chartColors.success,
                backgroundColor: chartColors.successLight,
                borderWidth: 3,
                fill: true,
                tension: 0.4,
                pointRadius: 5,
                pointHoverRadius: 7,
                pointBackgroundColor: chartColors.success,
                pointBorderColor: '#fff',
                pointBorderWidth: 2
            }]
        },
        options: {
            ...commonChartOptions,
            plugins: {
                ...commonChartOptions.plugins,
                tooltip: {
                    ...commonChartOptions.plugins.tooltip,
                    callbacks: {
                        label: function(context) {
                            return `Profundidade: ${context.parsed.y.toFixed(1)} cm`;
                        }
                    }
                }
            },
            scales: {
                ...commonChartOptions.scales,
                y: {
                    ...commonChartOptions.scales.y,
                    reverse: true, // Invertido: menor √© melhor
                    ticks: {
                        ...commonChartOptions.scales.y.ticks,
                        callback: function(value) {
                            return value.toFixed(1) + ' cm';
                        }
                    }
                }
            }
        }
    });
}

/**
 * Renderiza o gr√°fico de uso mensal do Vacuum Bell
 */
function renderChartVacuum() {
    const canvas = document.getElementById('chartVacuum');
    if (!canvas) return;

    const ctx = canvas.getContext('2d');

    // Destruir gr√°fico anterior se existir
    if (chartVacuum) {
        chartVacuum.destroy();
    }

    // Verificar se h√° dados
    if (Object.keys(vacuumData).length === 0) {
        canvas.style.display = 'none';
        const wrapper = canvas.parentElement;
        wrapper.innerHTML = `
            <div class="chart-empty-state">
                <p style="font-size: 3em;">ü´Å</p>
                <p><strong>Nenhum uso registrado ainda</strong></p>
                <p style="font-size: 0.9em;">Comece a usar o Vacuum Bell para ver as estat√≠sticas aqui</p>
            </div>
        `;
        return;
    }

    canvas.style.display = 'block';

    // Agrupar dados por m√™s/ano
    const monthlyData = {};
    Object.keys(vacuumData).forEach(dateStr => {
        if (vacuumData[dateStr].completed) {
            const date = new Date(dateStr);
            const monthYear = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
            monthlyData[monthYear] = (monthlyData[monthYear] || 0) + 1;
        }
    });

    // Ordenar por data e preparar labels
    const sortedMonths = Object.keys(monthlyData).sort();
    const labels = sortedMonths.map(monthYear => {
        const [year, month] = monthYear.split('-');
        const date = new Date(year, parseInt(month) - 1, 1);
        return date.toLocaleDateString('pt-BR', { month: 'short', year: 'numeric' });
    });

    const data = sortedMonths.map(monthYear => monthlyData[monthYear]);

    // Criar gr√°fico
    chartVacuum = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Dias de uso',
                data: data,
                backgroundColor: chartColors.primary,
                borderColor: chartColors.primary,
                borderWidth: 2,
                borderRadius: 8,
                hoverBackgroundColor: chartColors.secondary
            }]
        },
        options: {
            ...commonChartOptions,
            plugins: {
                ...commonChartOptions.plugins,
                tooltip: {
                    ...commonChartOptions.plugins.tooltip,
                    callbacks: {
                        label: function(context) {
                            return `Dias de uso: ${context.parsed.y}`;
                        }
                    }
                }
            },
            scales: {
                ...commonChartOptions.scales,
                y: {
                    ...commonChartOptions.scales.y,
                    beginAtZero: true,
                    ticks: {
                        ...commonChartOptions.scales.y.ticks,
                        stepSize: 1,
                        callback: function(value) {
                            return value + ' dias';
                        }
                    }
                }
            }
        }
    });
}

/**
 * Atualiza todos os gr√°ficos
 * Chamada sempre que novos dados s√£o salvos
 */
function updateAllCharts() {
    renderChartPeso();
    renderChartPectus();
    renderChartVacuum();
}
        // ========================================
        // INICIALIZA√á√ÉO
        // ========================================

        function init() {
            // Restaurar configura√ß√µes
            document.getElementById('vacuumWeek').value = settings.vacuumWeek;
            document.getElementById('vacuumMaxTime').value = settings.vacuumMaxTime;
            recalcularStreak();
            updateStreakDisplay();
            // Verificar e exibir mensagem motivacional
            verificarEExibirMensagem()
            // Verificar inatividade
            checkInactivity();
            
            // Atualizar displays
            updateDashboard();
            updateXPDisplay();
            
            // Renderizar calend√°rios
            renderVacuumCalendar();
            renderWorkoutCalendar();
            renderCareCalendar();
            
            // Carregar hist√≥ricos
            loadVacuumHistory();
            loadWorkoutHistory();
            loadCareHistory();
            loadWeightHistory();
            loadMeasurementHistory();
            loadPhotoGallery();
             updateAllCharts();
}
 // ========================================
// PATCH DE AUTENTICA√á√ÉO - ADICIONAR NO FINAL DO SCRIPT
// ========================================

// Substituir o window.onload existente por este:
// ========================================
// INICIALIZA√á√ÉO DO APP
// ========================================

window.onload = function() {
    // 1Ô∏è‚É£ Verificar se Firebase foi inicializado corretamente
    if (!firebaseAuth) {
        console.error('Firebase n√£o inicializado!');
        showLoginMessage('Erro ao conectar com Firebase.', 'error');
        return;
    }
    
    // 2Ô∏è‚É£ Observar mudan√ßas no estado de login
    firebaseAuth.onAuthStateChanged(async function(user) {
        if (user) {
            // ‚úÖ Usu√°rio est√° logado
            console.log('‚úÖ Usu√°rio logado:', user.email);
            
            currentUser = user;
            isOnlineMode = true;
            
            // 3Ô∏è‚É£ Esconder tela de login
            document.getElementById('loginScreen').classList.add('hidden');
            
            // 4Ô∏è‚É£ Mostrar email do usu√°rio
            showUserInfo();
            
            // 5Ô∏è‚É£ CARREGAR DADOS DO FIREBASE
            try {
                await loadUserData();
                
                // 6Ô∏è‚É£ Inicializar o app com os dados carregados
                init();
                
                showMessage('‚úÖ Bem-vindo de volta!', 'success');
                
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
                // Se falhar, inicializa com dados zerados
                init();
                showMessage('‚ö†Ô∏è Erro ao carregar dados. Come√ßando zerado.', 'warning');
            }
            
        } else {
            // ‚ùå Usu√°rio n√£o est√° logado
            console.log('‚ùå Nenhum usu√°rio logado');
            
            // Mostrar tela de login
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('userInfoContainer').style.display = 'none';
        }
    });
};

// ========================================
// CORRE√á√ïES NAS FUN√á√ïES EXISTENTES
// ========================================

// Atualizar a fun√ß√£o loadUserData para sincronizar com localStorage
const loadUserDataOriginal = loadUserData;
loadUserData = async function() {
    if (!isOnlineMode || !currentUser) {
        console.log('Modo offline - usando localStorage');
        return;
    }
    
    try {
        const userId = currentUser.uid;
        const snapshot = await firebaseDatabase.ref(`users/${userId}`).once('value');
        const data = snapshot.val();
        
        if (data) {
            // Dados existem na nuvem - usar eles
            console.log('Dados carregados da nuvem');
            vacuumData = data.vacuumData || {};
            workoutData = data.workoutData || {};
            careData = data.careData || {};
            weightData = data.weightData || [];
            measurementData = data.measurementData || [];
            photoData = data.photoData || [];
            settings = data.settings || { vacuumWeek: 1, vacuumMaxTime: 60, previousDaysAdded: 0 };
            xpData = data.xpData || { xpTratamento: 0, xpCorpo: 0, xpCuidado: 0, xpGeral: 0, lastActivity: formatDate(new Date()) };
            streakData = data.streakData || { streakAtual: 0, maiorStreak: 0, ultimoDiaAtivo: null, diasPausados: 0, streak7Bonus: false };
            
            
        } else {
            // Primeira vez logando - migrar dados do localStorage para nuvem
            console.log('Primeira vez logando - migrando dados locais para nuvem');
            await saveUserData();
        }
    } catch (error) {
        console.error('Erro ao carregar dados:', error);
        throw error;
    }
};

// Auto-salvar dados a cada 30 segundos quando logado
setInterval(function() {
    if (isOnlineMode && currentUser) {
        saveUserData().then(() => {
            console.log('Dados sincronizados automaticamente');
        }).catch(error => {
            console.error('Erro ao sincronizar:', error);
        });
    }
}, 30000); // 30 segundos

// ========================================
// FUN√á√ÉO PARA MOSTRAR INFORMA√á√ïES DO USU√ÅRIO
// ========================================

function showUserInfo() {
    if (isOnlineMode && currentUser) {
        const container = document.getElementById('userInfoContainer');
        const emailEl = document.getElementById('userEmail');
        
        emailEl.textContent = currentUser.email;
        container.style.display = 'block';
    }
}

// ========================================
// TRATAMENTO DE ERROS MELHORADO
// ========================================

// Sobrescrever handleLogin com tratamento de erro melhorado
const handleLoginOriginal = handleLogin;
handleLogin = async function() {
    const email = document.getElementById('loginEmail').value.trim();
    const password = document.getElementById('loginPassword').value;
    
    if (!email || !password) {
        showLoginMessage('Preencha todos os campos!');
        return;
    }
    
    // Mostrar loading
    const btnLogin = document.querySelector('.btn-login');
    const originalText = btnLogin.textContent;
    btnLogin.textContent = 'Entrando...';
    btnLogin.disabled = true;
    
    try {
        await firebaseAuth.signInWithEmailAndPassword(email, password);
        // O resto √© tratado pelo onAuthStateChanged
    } catch (error) {
        console.error('Erro no login:', error);
        showLoginMessage(getErrorMessage(error.code));
        btnLogin.textContent = originalText;
        btnLogin.disabled = false;
    }
};

// Sobrescrever handleRegister com tratamento de erro melhorado
const handleRegisterOriginal = handleRegister;
handleRegister = async function() {
    const email = document.getElementById('registerEmail').value.trim();
    const password = document.getElementById('registerPassword').value;
    
    if (!email || !password) {
        showLoginMessage('Preencha todos os campos!');
        return;
    }
    
    if (password.length < 6) {
        showLoginMessage('A senha deve ter no m√≠nimo 6 caracteres!');
        return;
    }
    
    // Mostrar loading
    const btnRegister = document.querySelector('.btn-login');
    const originalText = btnRegister.textContent;
    btnRegister.textContent = 'Criando conta...';
    btnRegister.disabled = true;
    
    try {
        await firebaseAuth.createUserWithEmailAndPassword(email, password);
        // O resto √© tratado pelo onAuthStateChanged
    } catch (error) {
        console.error('Erro no registro:', error);
        showLoginMessage(getErrorMessage(error.code));
        btnRegister.textContent = originalText;
        btnRegister.disabled = false;
    }
};

// Sobrescrever handleGoogleLogin
const handleGoogleLoginOriginal = handleGoogleLogin;
handleGoogleLogin = async function() {
    try {
        const provider = new firebase.auth.GoogleAuthProvider();
        await firebaseAuth.signInWithPopup(provider);
        // O resto √© tratado pelo onAuthStateChanged
    } catch (error) {
        console.error('Erro no login Google:', error);
        if (error.code !== 'auth/popup-closed-by-user') {
            showLoginMessage(getErrorMessage(error.code));
        }
    }
};

// ========================================
// MENSAGENS DE ERRO TRADUZIDAS
// ========================================

function getErrorMessage(code) {
    const messages = {
        'auth/user-not-found': 'Usu√°rio n√£o encontrado',
        'auth/wrong-password': 'Senha incorreta',
        'auth/email-already-in-use': 'Este email j√° est√° em uso',
        'auth/weak-password': 'Senha muito fraca (m√≠nimo 6 caracteres)',
        'auth/invalid-email': 'Email inv√°lido',
        'auth/popup-closed-by-user': 'Login cancelado',
        'auth/network-request-failed': 'Erro de conex√£o. Verifique sua internet.',
        'auth/too-many-requests': 'Muitas tentativas. Aguarde alguns minutos.',
        'auth/invalid-credential': 'Credenciais inv√°lidas. Verifique email e senha.'
    };
    return messages[code] || `Erro: ${code}. Tente novamente.`;
}

console.log('‚úÖ Patch de autentica√ß√£o carregado com sucesso!');

        
        </script>
</body>
</html>
